<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BellGo Admin Premium</title>
    
    <link rel="manifest" id="dynamicManifest" href="manifest.json?icon=admin">
    
    <meta name="theme-color" content="#121212">
    <link rel="apple-touch-icon" href="admin.png"> 
    
    <link rel="stylesheet" href="/style.css">
    
    <script src="menu-presets.js"></script> 
    <script src="https://js.stripe.com/v3/"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div id="mainApp">
        <div class="header">
            <div class="store-identity">
                <span id="connDot" class="status-dot" onclick="App.forceReconnect()"></span>
                <input type="text" id="inpStoreNameHeader" class="header-store-input" placeholder="Όνομα Καταστήματος..." onblur="App.saveStoreName()" onkeydown="if(event.key==='Enter') this.blur()">
            </div>
            
            <div class="header-actions">
                <button id="btnSettings" class="btn-icon" onclick="App.openSettingsModal()" title="Ρυθμίσεις">⚙️</button>
                <button id="btnMenuToggle" class="btn-icon" onclick="App.toggleMenuMode()" title="Μενού">📜</button>
                <div class="btn-icon-wrapper">
                    <button id="adminChatBtn" class="btn-icon" onclick="App.toggleAdminChat()" title="Chat">📁</button>
                    <div id="chatBadge" class="chat-badge"></div>
                </div>
                <button class="btn-icon" onclick="App.toggleFakeLock()" title="Μαύρη Οθόνη">🌙</button>
                <button id="btnNewOrderSidebar" class="btn-icon" onclick="App.toggleOrderSidebar()" title="Νέα Παραγγελία" style="display:none; background:#00E676; color:black;">➕</button>
                <button id="btnKitchenExit" class="btn-icon" onclick="App.logout()" title="Έξοδος" style="display:none; background:var(--danger); color:white;">🚪</button>
            </div>
        </div>

        <div class="admin-main-area">
            <div id="menuFullPanel">
                <div class="menu-header">
                    <span class="menu-title">ΕΠΕΞΕΡΓΑΣΙΑ ΜΕΝΟΥ</span>
                    <div style="display:flex; gap:10px;">
                        <button id="btnBackCat" class="btn-back" onclick="App.goBackToCategories()">🔙 ΠΙΣΩ</button>
                        <button class="btn-add" onclick="App.handlePlusButton()" title="Προσθήκη">➕</button>
                    </div>
                </div>
                
                <div style="margin-bottom:15px; padding:10px; background:#1a1a1a; border:1px solid #333; border-radius:10px; display:flex; align-items:center; justify-content:space-between;">
                    <span style="color:#aaa; font-size:14px;">Τιμή Κουβέρ (€):</span>
                    <input type="number" id="inpCoverPrice" style="width:80px; padding:8px; background:#000; border:1px solid #444; color:white; border-radius:6px; text-align:center;" placeholder="0.00" step="0.10" onblur="App.autoSaveSettings()">
                </div>

                <div id="menuInputContainer"></div>
            </div>

            <div id="desktopArea"></div>
            
            <div id="windowsContainer"></div>
            
            <div id="staffContainer">
                <div class="sidebar-header" onclick="App.toggleStaffPanel()">
                    <span>ΠΡΟΣΩΠΙΚΟ (ONLINE)</span>
                    <span id="staffToggleIcon" class="sidebar-toggle-icon">▼</span>
                </div>
                <div id="staffList"></div>
            </div>
        </div>

        <!-- ✅ NEW: SIDEBAR ORDER PANEL (FULL SCREEN RIGHT) -->
        <div id="orderSidebar" class="order-panel" style="position:fixed; top:0; left:-100%; width:100%; height:100%; transition:left 0.3s; z-index:4000; border-top:none; border-right:2px solid #333; display:flex; flex-direction:column;">
            <div class="panel-header-bar" style="background:#111; justify-content:space-between; padding:0 15px; cursor:default;">
                <span style="font-weight:bold; color:#00E676;">ΝΕΑ ΠΑΡΑΓΓΕΛΙΑ (ΤΑΜΕΙΟ)</span>
                <button id="btnCloseSidebar" onclick="App.toggleOrderSidebar()" style="background:none; border:none; color:white; font-size:30px; padding:15px; cursor:pointer; z-index:5000;">✕</button>
            </div>
            <div class="panel-content" style="background:#1a1a1a;">
                <div class="form-row">
                    <div class="input-group" style="flex:0.5;">
                        <label>PASO</label>
                        <input type="checkbox" id="sidebarPaso" style="width:30px; height:30px;" checked onchange="App.togglePaso()">
                    </div>
                    <div class="input-group">
                        <label>ΤΡΑΠΕΖΙ</label>
                        <input type="text" id="sidebarTable" class="input-box" placeholder="#" disabled>
                    </div>
                    <div class="input-group">
                        <label>ΚΟΥΒΕΡ</label>
                        <input type="number" id="sidebarCovers" class="input-box" placeholder="0">
                    </div>
                </div>
                <div id="sidebarMenuContainer" style="flex:1; overflow-y:auto; margin-bottom:10px; border:1px solid #333; border-radius:8px; padding:5px;"></div>
                <textarea id="sidebarOrderText" class="order-text" placeholder="Προϊόντα..." style="height:100px;"></textarea>
                <div id="sidebarTotal" style="text-align:right; font-size:20px; font-weight:bold; color:#FFD700; margin-bottom:10px;">ΣΥΝΟΛΟ: 0.00€</div>
                <button class="btn-send" onclick="App.sendSidebarOrder()">ΑΠΟΣΤΟΛΗ 🚀</button>
            </div>
        </div>
    </div>
    
    <div id="adminChatOverlay">
        <div style="padding:15px; border-bottom:1px solid #333; display:flex; justify-content:space-between; align-items:center;">
            <span style="font-size:18px; font-weight:bold; color:var(--text-main);">💬 Ομαδικό Chat</span>
            <button onclick="App.toggleAdminChat()" style="background:none; border:none; color:white; font-size:24px;">✕</button>
        </div>
        <div class="chat-messages" id="adminChatBox"></div>
        <div class="chat-input-area">
            <input type="text" id="adminChatInp" class="chat-inp" placeholder="Μήνυμα...">
            <button class="btn-icon menu-active" onclick="App.sendChat()">➤</button>
        </div>
    </div>

    <div id="settingsModal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title">⚙️ ΡΥΘΜΙΣΕΙΣ</h3>
            
            <div class="settings-section" style="border: 1px solid var(--accent);">
                <div class="settings-label" style="color:var(--accent);">ΑΥΤΟΜΑΤΟ ΜΕΝΟΥ (TEMPLATE)</div>
                <select id="selShopType" class="inp-settings" style="margin-bottom:10px;">
                    <option value="" disabled selected>Επιλέξτε είδος...</option>
                    <option value="coffee_takeaway">☕ Cafe Takeaway</option>
                    <option value="coffee_bar">🍸 Cafe Bar</option>
                    <option value="pizzeria">🍕 Pizzeria</option>
                    <option value="souvlaki">🍖 Souvlaki / Grill</option>
                </select>
                <button class="modal-btn" style="background:var(--accent); color:black;" onclick="App.applyPresetMenu()">📥 ΦΟΡΤΩΣΗ ΠΡΟΤΥΠΟΥ</button>
            </div>

            <div class="settings-section">
                <div class="settings-label">ΚΑΤΑΣΤΑΣΗ</div>
                <div class="switch-row">
                    <span>ΠΕΛΑΤΕΣ (Delivery)</span>
                    <label class="switch"><input type="checkbox" id="switchCust" onclick="App.toggleStatus('customer')"><span class="slider"></span></label>
                </div>
                <div class="switch-row">
                    <span>ΠΡΟΣΩΠΙΚΟ (Staff)</span>
                    <label class="switch"><input type="checkbox" id="switchStaff" onclick="App.toggleStatus('staff')"><span class="slider"></span></label>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-label">ΩΡΑΡΙΑ</div>
                <div style="font-size:11px; color:#aaa; text-align:left; margin-bottom:4px;">ΩΡΑ ΑΝΑΝΕΩΣΗΣ ΚΑΤΑΛΟΓΟΥ</div>
                <div style="display:flex; gap:10px; margin-bottom:5px;">
                    <input type="time" id="inpResetTime" class="inp-settings" title="Reset Time" onchange="App.autoSaveSettings()">
                    <input type="text" id="inpHours" class="inp-settings" placeholder="π.χ. 12:00-00:00" onblur="App.autoSaveSettings()">
                </div>
                <button class="modal-btn" style="background:#333; font-size:13px;" onclick="App.openScheduleModal()">📅 ΕΒΔΟΜΑΔΙΑΙΟ ΠΡΟΓΡΑΜΜΑ</button>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="modal-btn" style="background:#FF9800; color:black;" onclick="App.openPinModal()">🔑 PIN</button>
                <button class="modal-btn" style="background:#00E676; color:black;" onclick="App.openStatsModal()">📊 ΣΤΑΤΙΣΤΙΚΑ</button>
                <button class="modal-btn" style="background:#2196F3;" onclick="App.showLink()">🔗 LINK</button>
            </div>

            <button class="modal-btn" style="background:#635BFF;" onclick="window.location.href='/connect-stripe'">💳 CONNECT STRIPE</button>
            <div id="stripeStatus" style="font-size:10px; color:#aaa; text-align:center;">Checking...</div>

            <button class="modal-btn" style="background:var(--danger); margin-top:10px;" onclick="App.logout()">🚪 ΕΞΟΔΟΣ</button>
            <button onclick="document.getElementById('settingsModal').style.display='none'" style="background:none; border:none; color:#777; margin-top:10px;">ΚΛΕΙΣΙΜΟ</button>
        </div>
    </div>

    <div id="scheduleModal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title">📅 ΠΡΟΓΡΑΜΜΑ</h3>
            <div id="weekDaysContainer"></div>
            <button class="modal-btn" style="background:var(--primary); color:black; margin-top:10px;" onclick="App.saveSchedule()">💾 ΑΠΟΘΗΚΕΥΣΗ</button>
            <button onclick="document.getElementById('scheduleModal').style.display='none'; document.getElementById('settingsModal').style.display='flex';" style="background:none; border:none; color:#777; margin-top:10px;">ΠΙΣΩ</button>
        </div>
    </div>

    <div id="extrasModal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title" id="extrasModalTitle">EXTRA ΥΛΙΚΑ</h3>
            <div id="extrasListContainer" class="extras-list"></div>
            
            <div style="border-top:1px solid #333; padding-top:15px; margin-top:10px;">
                <div class="settings-label">ΠΡΟΣΘΗΚΗ ΝΕΟΥ</div>
                <div class="extra-inputs">
                    <input type="text" id="inpExtraName" class="extra-name-inp" placeholder="Όνομα (π.χ. Σως)">
                    <input type="number" id="inpExtraPrice" class="extra-price-inp" placeholder="€" step="0.10">
                </div>
                <button class="modal-btn" style="background:#2196F3;" onclick="App.addExtraRow()">➕ ΠΡΟΣΘΗΚΗ</button>
            </div>
            
            <button class="modal-btn" style="background:var(--primary); color:black; margin-top:15px;" onclick="App.saveExtras()">💾 ΕΤΟΙΜΟ</button>
            <button onclick="document.getElementById('extrasModal').style.display='none'" style="background:none; border:none; color:#777; margin-top:5px;">ΑΚΥΡΟ</button>
        </div>
    </div>

    <div id="pinChangeModal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title">PIN</h3>
            <div id="pinDisplay" style="font-size:30px; letter-spacing:10px; color:var(--primary); font-weight:bold; margin:10px 0;"></div>
            <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px;">
                <button class="modal-btn" style="background:#333;" onclick="PIN.add(1)">1</button><button class="modal-btn" style="background:#333;" onclick="PIN.add(2)">2</button><button class="modal-btn" style="background:#333;" onclick="PIN.add(3)">3</button>
                <button class="modal-btn" style="background:#333;" onclick="PIN.add(4)">4</button><button class="modal-btn" style="background:#333;" onclick="PIN.add(5)">5</button><button class="modal-btn" style="background:#333;" onclick="PIN.add(6)">6</button>
                <button class="modal-btn" style="background:#333;" onclick="PIN.add(7)">7</button><button class="modal-btn" style="background:#333;" onclick="PIN.add(8)">8</button><button class="modal-btn" style="background:#333;" onclick="PIN.add(9)">9</button>
                <button class="modal-btn" style="background:var(--danger);" onclick="PIN.clear()">C</button><button class="modal-btn" style="background:#333;" onclick="PIN.add(0)">0</button><button class="modal-btn" style="background:var(--primary); color:black;" onclick="PIN.submit()">OK</button>
            </div>
            <button onclick="App.closePinModal()" style="background:none; border:none; color:#777; margin-top:10px;">ΑΚΥΡΟ</button>
        </div>
    </div>

    <div id="saveModeModal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title">ΑΠΟΘΗΚΕΥΣΗ</h3>
            <p style="color:#aaa;">Πώς θέλετε να αποθηκευτεί;</p>
            <button class="modal-btn" style="background:#2196F3;" onclick="App.executeSave('temporary')">📅 ΣΗΜΕΡΑ ΜΟΝΟ</button>
            <button class="modal-btn" style="background:var(--danger);" onclick="App.executeSave('permanent')">♾️ ΜΟΝΙΜΑ</button>
            <button onclick="document.getElementById('saveModeModal').style.display='none'" style="background:none; border:none; color:#777;">ΑΚΥΡΟ</button>
        </div>
    </div>

    <!-- ✅ NEW: STATISTICS MODAL -->
    <div id="statsModal" class="modal-overlay">
        <div class="modal-box" style="max-width:500px;">
            <h3 class="modal-title">📊 ΣΤΑΤΙΣΤΙΚΑ ΜΗΝΑ</h3>
            <div id="statsContent" style="text-align:left; width:100%; max-height:60vh; overflow-y:auto;">
                <p style="text-align:center; color:#aaa;">Φόρτωση...</p>
            </div>
            <button class="modal-btn" style="background:#2196F3; margin-top:10px;" onclick="App.refreshStats()">🔄 ΑΝΑΝΕΩΣΗ</button>
            <button onclick="document.getElementById('statsModal').style.display='none'; document.getElementById('settingsModal').style.display='flex';" style="background:none; border:none; color:#777; margin-top:10px;">ΠΙΣΩ</button>
        </div>
    </div>

    <div id="qrOverlay" onclick="this.style.display='none'" class="modal-overlay" style="align-items:center; justify-content:center;">
        <div class="qr-box" onclick="event.stopPropagation()" style="background:white; padding:20px; border-radius:16px; text-align:center;">
            <div style="color:black; font-weight:bold; font-size:18px; margin-bottom:10px;">📲 Link Καταστήματος</div>
            <div id="qrcode"></div>
            <a id="storeLink" href="#" target="_blank" style="display:block; margin-top:10px; color:#333; font-size:12px;">...</a>
            <button onclick="document.getElementById('qrOverlay').style.display='none'" style="margin-top:15px; padding:10px 20px; background:var(--danger); color:white; border:none; border-radius:8px;">ΚΛΕΙΣΙΜΟ</button>
        </div>
    </div>

    <div id="fakeLockOverlay" onclick="App.toggleFakeLock()"><div>Tap to Unlock</div></div>

    <script type="module" src="premium.js"></script>
</body>
</html>
