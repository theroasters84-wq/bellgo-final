<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BellGo WEAPONIZED</title>
    <style>
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: #000; color: #fff; 
            font-family: sans-serif; text-align: center; 
            margin: 0; height: 100vh; overflow: hidden; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* ÎŸÎ˜ÎŸÎÎ•Î£ */
        .screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        /* ÎšÎŸÎ¥ÎœÎ Î™Î‘ */
        .btn { width: 90%; padding: 25px; font-size: 22px; margin: 10px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; color: white; }
        .btn-green { background: #00E676; color: #000; box-shadow: 0 0 15px #00E676; }
        .btn-blue { background: #2962FF; box-shadow: 0 0 15px #2962FF; }
        
        /* FAKE LOCK (ÎœÎ‘Î¥Î¡Î— ÎŸÎ˜ÎŸÎÎ—) */
        #fakeLockScreen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 5000; cursor: pointer;
            flex-direction: column; align-items: center; justify-content: center;
        }

        /* ÎŸÎ˜ÎŸÎÎ— ÎšÎ›Î—Î£Î—Î£ (ALARM WEAPON) */
        #alarmScreen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #D50000; z-index: 9999; /* Î Î¬Î½Ï‰ Î±Ï€ÏŒ ÏŒÎ»Î± */
            flex-direction: column; align-items: center; justify-content: center;
            animation: panic 0.2s infinite;
        }

        /* ANIMATION Î Î‘ÎÎ™ÎšÎŸÎ¥ */
        @keyframes panic { 
            0% { background: #D50000; transform: scale(1); } 
            50% { background: #FF1744; transform: scale(1.02); } 
            100% { background: #D50000; transform: scale(1); } 
        }

        .stop-btn {
            width: 250px; height: 250px; border-radius: 50%;
            background: white; color: red; font-size: 40px; font-weight: 900;
            border: 10px solid yellow; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <div id="loginScreen" class="screen active">
        <h1 style="color:#00E676;">BELLGO WEAPONIZED</h1>
        <button class="btn btn-green" onclick="startSystem('admin')">Î•Î™ÎœÎ‘Î™ ADMIN (Î ÎŸÎœÎ ÎŸÎ£)</button>
        <button class="btn btn-blue" onclick="startSystem('staff')">Î•Î™ÎœÎ‘Î™ STAFF (Î”Î•ÎšÎ¤Î—Î£)</button>
    </div>

    <div id="adminScreen" class="screen">
        <h1>ADMIN PANEL</h1>
        <button class="btn btn-green" id="callBtn" onclick="sendCall()">ğŸ“¢ ÎšÎ›Î—Î£Î— ÎŸÎ›Î©Î</button>
        <p id="adminStatus" style="color:#888;">System Ready</p>
    </div>

    <div id="staffScreen" class="screen">
        <h1 style="font-size: 50px;">ğŸ§</h1>
        <h2>SERVICE ACTIVE</h2>
        <div style="font-size:12px; color:#00E676; border:1px solid #00E676; padding:10px; border-radius:10px;">
            â— Anti-Sleep Engine: ON<br>
            â— Hardware Buttons: MAPPED
        </div>
        <button class="btn btn-blue" style="background:#222; margin-top:50px;" onclick="enableFakeLock()">
            ğŸŒ™ FAKE LOCK (SAFE MODE)
        </button>
    </div>

    <div id="fakeLockScreen" onclick="disableFakeLock()">
        <div style="color:#333; font-size:12px;">Double Tap to Wake</div>
    </div>

    <div id="alarmScreen">
        <h1 style="font-size:50px; color:white; margin-bottom:20px;">ğŸš¨ ÎšÎ›Î—Î£Î—! ğŸš¨</h1>
        <div class="stop-btn" onclick="stopAlarm()">STOP</div>
        <p style="color:white; font-weight:bold; margin-top:30px;">
            Î Î¬Ï„Î± STOP Î® Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ ÎºÎ¿Ï…Î¼Ï€Î¯ ÏƒÏ„Î¿ Ï€Î»Î¬Î¹
        </p>
    </div>

    <audio id="alertSound" src="alert.mp3" loop preload="auto"></audio>
    <audio id="silentLoop" loop>
        <source src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjIwLjEwMAAAAAAAAAAAAAAA//oeAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAEAAABIADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD//////////////////////////////////8AAAAATGF2YzU4LjM1AAAAAAAAAAAAAAAAJAAAAAAAAAAAASCC8iEAAAAA//oeZAAAAABAAAAA" type="audio/mpeg">
    </audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myRole = '';
        let wakeLock = null;
        let fightLoop = null; // Î“Î¹Î± Ï„Î¿ Fully Kiosk

        // --- Î•ÎšÎšÎ™ÎÎ—Î£Î— Î£Î¥Î£Î¤Î—ÎœÎ‘Î¤ÎŸÎ£ ---
        async function startSystem(role) {
            myRole = role;
            
            // 1. Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î‰Ï‡Î¿Ï… (Anti-Sleep)
            const silent = document.getElementById('silentLoop');
            silent.volume = 0.01;
            await silent.play().catch(e => console.log("Audio block"));

            // 2. Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Wake Lock (Anti-Dim)
            if ('wakeLock' in navigator) {
                try { wakeLock = await navigator.wakeLock.request('screen'); } catch(e){}
            }

            // 3. Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Server
            // Î•Î´Ï Î±Ï€Î»Î¬ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î¿ store 'General' Î³Î¹Î± ÎµÏ…ÎºÎ¿Î»Î¯Î±, Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï„Î¿ Î±Î»Î»Î¬Î¾ÎµÎ¹Ï‚
            socket.emit('join-store', { storeName: 'General', username: role, role: role });

            // 4. Î‘Î»Î»Î±Î³Î® ÎŸÎ¸ÏŒÎ½Î·Ï‚
            document.getElementById('loginScreen').classList.remove('active');
            if(role === 'admin') document.getElementById('adminScreen').classList.add('active');
            else document.getElementById('staffScreen').classList.add('active');

            // 5. MEDIA SESSION API (Î¤ÎŸ ÎšÎŸÎ›Î ÎŸ Î“Î™Î‘ Î¤Î‘ ÎšÎŸÎ¥ÎœÎ Î™Î‘)
            setupMediaSession("BellGo Standby");
        }

        // --- MEDIA SESSION "WEAPON" ---
        // Î‘Ï…Ï„ÏŒ ÎºÎ¬Î½ÎµÎ¹ Ï„Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ Î½Î± Î½Î¿Î¼Î¯Î¶ÎµÎ¹ ÏŒÏ„Î¹ ÎµÎ¯Î¼Î±ÏƒÏ„Îµ Player, Î¬ÏÎ± Î±ÎºÎ¿ÏÎµÎ¹ Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬
        function setupMediaSession(state) {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: state,
                    artist: 'System Online',
                    album: 'Do Not Close'
                });

                // ÎŸÎ›Î‘ Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ ÎºÎ¬Î½Î¿Ï…Î½ STOP
                const actionHandler = () => {
                    if(document.getElementById('alarmScreen').style.display === 'flex') {
                        stopAlarm();
                    }
                };

                navigator.mediaSession.setActionHandler('play', actionHandler);
                navigator.mediaSession.setActionHandler('pause', actionHandler);
                navigator.mediaSession.setActionHandler('stop', actionHandler);
                navigator.mediaSession.setActionHandler('previoustrack', actionHandler);
                navigator.mediaSession.setActionHandler('nexttrack', actionHandler);
            }
        }

        // --- SEND CALL (ADMIN) ---
        function sendCall() {
            socket.emit('trigger-alarm', { targetId: null });
            const btn = document.getElementById('callBtn');
            btn.style.background = "#555";
            btn.innerText = "ÎšÎ‘Î›Î•Î™...";
            setTimeout(() => { btn.style.background = "#00E676"; btn.innerText = "ğŸ“¢ ÎšÎ›Î—Î£Î— ÎŸÎ›Î©Î"; }, 2000);
        }

        // --- RECEIVE CALL (STAFF) ---
        socket.on('ring-bell', () => {
            // Î‘Î½ ÎµÎ¯Î¼Î±Î¹ admin Î´ÎµÎ½ Ï‡Ï„Ï…Ï€Î¬Ï‰
            if(myRole === 'admin') return;

            // 1. Î•ÎœÎ¦Î‘ÎÎ™Î£Î— ALARM SCREEN (OVERLAY)
            document.getElementById('alarmScreen').style.display = 'flex';
            
            // 2. Î—Î§ÎŸÎ£ Î£Î¥ÎÎ‘Î“Î•Î¡ÎœÎŸÎ¥
            const alertSnd = document.getElementById('alertSound');
            alertSnd.currentTime = 0;
            alertSnd.volume = 1.0;
            alertSnd.play();

            // 3. Î‘Î›Î›Î‘Î“Î— MEDIA SESSION (Î“Î¹Î± Î½Î± Î´Î¿ÏÎ¼Îµ Ï„Î¯Ï„Î»Î¿ ÏƒÏ„Î¿ Lock Screen)
            setupMediaSession("ğŸš¨ ÎšÎ›Î—Î£Î— Î‘Î ÎŸ ÎšÎŸÎ¥Î–Î™ÎÎ‘! ğŸš¨");

            // 4. Î”ÎŸÎÎ—Î£Î— (Î•Ï€Î¹Î¸ÎµÏ„Î¹ÎºÎ®)
            if(navigator.vibrate) navigator.vibrate([1000, 200, 1000, 200, 1000]);

            // 5. FULLY KIOSK ATTACK (Î‘Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹)
            if(window.fully) {
                fully.turnScreenOn();
                fully.bringToForeground();
                // Loop Î³Î¹Î± Î½Î± Î¼Î­Î½ÎµÎ¹ Î¼Ï€ÏÎ¿ÏƒÏ„Î¬
                if(fightLoop) clearInterval(fightLoop);
                fightLoop = setInterval(() => {
                    fully.bringToForeground();
                    fully.turnScreenOn();
                }, 800);
            }
        });

        // --- STOP ALARM ---
        function stopAlarm() {
            document.getElementById('alarmScreen').style.display = 'none';
            
            const alertSnd = document.getElementById('alertSound');
            alertSnd.pause();
            alertSnd.currentTime = 0;

            if(navigator.vibrate) navigator.vibrate(0);
            if(fightLoop) clearInterval(fightLoop);

            // Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î®ÏÎµÎ¼Î¿ session
            setupMediaSession("BellGo Standby");
        }

        // --- FAKE LOCK ---
        function enableFakeLock() {
            document.getElementById('fakeLockScreen').style.display = 'flex';
            if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
        }
        function disableFakeLock() {
            document.getElementById('fakeLockScreen').style.display = 'none';
            if(document.exitFullscreen) document.exitFullscreen();
        }
    </script>
</body>
</html>
