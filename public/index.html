<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BellGo Weaponized V8</title>
    <style>
        * { box-sizing: border-box; user-select: none; }
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        .screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .active { display: flex; }

        input { padding: 15px; margin: 10px; width: 90%; border-radius: 10px; border: 1px solid #444; background: #222; color: white; font-size: 18px; text-align: center; }
        .btn { padding: 20px; font-size: 20px; width: 90%; margin: 10px; border-radius: 15px; border: none; font-weight: bold; cursor: pointer; }
        .btn-green { background: #00E676; color: #000; }
        .btn-blue { background: #2962FF; color: #fff; }
        .btn-orange { background: #FF9800; color: #000; }

        /* FAKE LOCK */
        #fakeLockScreen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 5000; flex-direction: column; align-items: center; justify-content: center; }

        /* ALARM OVERLAY */
        #alarmScreen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: red; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; animation: panic 0.2s infinite; }
        @keyframes panic { 0% { background: #D50000; } 50% { background: #FF1744; } 100% { background: #D50000; } }
        .stop-btn { width: 200px; height: 200px; border-radius: 50%; background: white; color: red; font-size: 35px; font-weight: 900; border: 8px solid yellow; }
    </style>
</head>
<body>

    <div id="loginScreen" class="screen active">
        <h1 style="color:#00E676;">BELLGO V8</h1>
        
        <div style="background:#1e1e1e; padding:15px; border-radius:15px; margin-bottom:20px; border:1px solid #FF9800;">
            <p style="color:#FF9800; margin:0 0 10px 0; font-weight:bold;">ğŸ¤– Setup Bot</p>
            <button class="btn btn-orange" onclick="runPermissionBot()" style="font-size:14px; padding:10px;">Î‘ÎÎŸÎ™Î“ÎœÎ‘ Î Î‘Î¡Î‘Î˜Î¥Î¡Î©Î Î‘Î”Î•Î™Î©Î</button>
        </div>

        <input type="text" id="storeName" placeholder="ÎŒÎ½Î¿Î¼Î± ÎœÎ±Î³Î±Î¶Î¹Î¿Ï">
        <input type="text" id="username" placeholder="ÎŒÎ½Î¿Î¼Î± Î§ÏÎ®ÏƒÏ„Î·">
        <button class="btn btn-green" onclick="startApp('admin')">Î•Î™Î£ÎŸÎ”ÎŸÎ£ (Î ÎŸÎœÎ ÎŸÎ£)</button>
        <button class="btn btn-blue" onclick="startApp('staff')">Î•Î™Î£ÎŸÎ”ÎŸÎ£ (Î”Î•ÎšÎ¤Î—Î£)</button>
    </div>

    <div id="mainScreen" class="screen">
        <h2 id="statusTitle">Ready</h2>
        <button class="btn btn-green" id="adminCallBtn" style="display:none;" onclick="triggerAlarm()">ğŸ“¢ ÎšÎ›Î—Î£Î— ÎŸÎ›Î©Î</button>
        
        <div id="staffControls" style="display:none;">
            <button class="btn" style="background:#222; color:#888;" onclick="enableFakeLock()">ğŸŒ™ FAKE LOCK (SAFE)</button>
            <p style="font-size:12px; color:#555; margin-top:10px;">ÎœÎ·Î½ ÎºÎ»ÎµÎ¹Î´ÏÎ½ÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯.<br>Î Î¬Ï„Î± Ï„Î¿ Fake Lock.</p>
        </div>
    </div>

    <div id="alarmScreen">
        <h1 style="color:white; font-size:40px;">ğŸ”” ÎšÎ›Î—Î£Î—!</h1>
        <button class="stop-btn" onclick="stopAlarm()">STOP</button>
    </div>

    <div id="fakeLockScreen" onclick="disableFakeLock()">
        <p style="color:#222;">Double Tap to Unlock</p>
    </div>

    <audio id="alertSound" src="alert.mp3" loop></audio>
    <audio id="silentLoop" src="silence.mp3" loop></audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myRole = '';
        let fightLoop = null;

        // --- ğŸ¤– BOT: Î‘ÎÎŸÎ™Î“ÎœÎ‘ Î‘Î”Î•Î™Î©Î ---
        function runPermissionBot() {
            if (typeof fully !== 'undefined') {
                fully.requestOverlayPermission(); // Î Î±ÏÎ¬Î¸Ï…ÏÎ¿ Overlay
                setTimeout(() => { fully.requestIgnoreBatteryOptimizations(); }, 3000); // Î Î±ÏÎ¬Î¸Ï…ÏÎ¿ ÎœÏ€Î±Ï„Î±ÏÎ¯Î±Ï‚
                fully.showToast("ğŸ¤– Î‘ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎµ Ï„Î¹Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ ÏƒÏ„Î± Ï€Î±ÏÎ¬Î¸Ï…ÏÎ±!");
            } else {
                alert("Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î¼ÏŒÎ½Î¿ ÏƒÎµ Fully Kiosk Browser!");
            }
        }

        // --- Î•ÎšÎšÎ™ÎÎ—Î£Î— ---
        async function startApp(role) {
            const store = document.getElementById('storeName').value;
            const user = document.getElementById('username').value;
            if(!store || !user) return alert("Î’Î¬Î»Îµ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±!");

            myRole = role;
            socket.emit('join-store', { storeName: store, username: user, role: role });

            // Anti-Sleep Engine
            document.getElementById('silentLoop').volume = 0.05;
            document.getElementById('silentLoop').play().catch(()=>{});

            // Native Fully Settings
            if (typeof fully !== 'undefined') {
                fully.setBooleanSetting("keepScreenOn", true);
                fully.setBooleanSetting("unlockScreen", true);
                fully.setBooleanSetting("listenVolumeButtons", true);
            }

            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('mainScreen').classList.add('active');
            
            if(role === 'admin') document.getElementById('adminCallBtn').style.display = 'block';
            else document.getElementById('staffControls').style.display = 'block';

            setupMediaSession();
        }

        // --- MEDIA SESSION (Hardware Buttons) ---
        function setupMediaSession() {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({ title: 'BellGo Protection Active' });
                const handler = () => { if(isRinging) stopAlarm(); };
                navigator.mediaSession.setActionHandler('play', handler);
                navigator.mediaSession.setActionHandler('pause', handler);
            }
        }

        // --- ALARM LOGIC ---
        socket.on('ring-bell', (data) => {
            document.getElementById('alarmScreen').style.display = 'flex';
            document.getElementById('alertSound').play();
            
            if (typeof fully !== 'undefined') {
                fully.turnScreenOn();
                fully.bringToForeground();
                fully.setMusicVolume(100);
                // Aggressive Loop
                if(fightLoop) clearInterval(fightLoop);
                fightLoop = setInterval(() => { fully.bringToForeground(); }, 800);
            }
            if(navigator.vibrate) navigator.vibrate([1000, 500, 1000]);
        });

        function stopAlarm() {
            document.getElementById('alarmScreen').style.display = 'none';
            document.getElementById('alertSound').pause();
            if(fightLoop) { clearInterval(fightLoop); fightLoop = null; }
            if(navigator.vibrate) navigator.vibrate(0);
        }

        function triggerAlarm() { socket.emit('trigger-alarm'); }

        // --- FAKE LOCK ---
        function enableFakeLock() { 
            document.getElementById('fakeLockScreen').style.display = 'flex';
            if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
        }
        function disableFakeLock() { 
            document.getElementById('fakeLockScreen').style.display = 'none'; 
            if(document.exitFullscreen) document.exitFullscreen();
        }

        window.addEventListener('keydown', () => { if(document.getElementById('alarmScreen').style.display === 'flex') stopAlarm(); });
    </script>
</body>
</html>
