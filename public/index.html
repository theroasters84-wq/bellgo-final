<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BellGo Service</title>
    <style>
        /* Î’Î±ÏƒÎ¹ÎºÏŒ Î£Ï„Ï…Î» */
        body { background-color: #121212; color: white; font-family: sans-serif; text-align: center; margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; user-select: none; }
        
        .screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        /* ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ */
        button { width: 80%; padding: 20px; font-size: 20px; margin: 10px; border-radius: 15px; border: none; font-weight: bold; cursor: pointer; }
        .btn-green { background: #00E676; color: black; }
        .btn-red { background: #FF1744; color: white; }
        .btn-black { background: #222; color: #888; border: 1px solid #444; }

        /* FAKE LOCK (Î— ÎœÎ±ÏÏÎ· ÎŸÎ¸ÏŒÎ½Î·) */
        #fakeLockLayer {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 1000; color: #222;
            flex-direction: column; align-items: center; justify-content: center;
        }

        /* POP UP ÎšÎ›Î—Î£Î—Î£ (Î ÎµÏ„Î¬Î³ÎµÏ„Î±Î¹ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ ÏŒÎ»Î±) */
        #callOverlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: red; z-index: 2000; /* Î Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î¿ Fake Lock */
            flex-direction: column; align-items: center; justify-content: center;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse { 0% { background: #D50000; } 50% { background: #FF1744; } 100% { background: #D50000; } }
        
        .big-text { font-size: 40px; font-weight: bold; margin-bottom: 30px; }
    </style>
</head>
<body>

    <div id="roleScreen" class="screen active">
        <h1>BellGo</h1>
        <button class="btn-green" onclick="selectRole('sender')">ğŸ”” Î•Î™ÎœÎ‘Î™ Î ÎŸÎœÎ ÎŸÎ£</button>
        <button class="btn-black" onclick="selectRole('receiver')">ğŸ‘‚ Î•Î™ÎœÎ‘Î™ Î”Î•ÎšÎ¤Î—Î£</button>
    </div>

    <div id="senderScreen" class="screen">
        <h1>Î ÎŸÎœÎ ÎŸÎ£</h1>
        <button class="btn-green" id="callBtn" onclick="makeCall()">ğŸ”” ÎšÎ›Î—Î£Î—</button>
        <p id="senderStatus" style="margin-top:20px; color:#888;">ÎˆÏ„Î¿Î¹Î¼Î¿</p>
    </div>

    <div id="receiverScreen" class="screen">
        <h1>Î”Î•ÎšÎ¤Î—Î£</h1>
        <p style="color:#00E676; font-size:12px;">â— Service Active</p>
        
        <button class="btn-black" onclick="enableFakeLock()">
            ğŸŒ™ Fake Lock<br><span style="font-size:12px">(ÎœÎ±ÏÏÎ· ÎŸÎ¸ÏŒÎ½Î·)</span>
        </button>
        <p style="font-size:12px; color:#555; margin-top:10px;">*ÎœÎ·Î½ Ï€Î±Ï„Î¬Ï‚ Ï„Î¿ Home Button.<br>Î Î¬Ï„Î± Ï„Î¿ Fake Lock.</p>
    </div>

    <div id="fakeLockLayer" onclick="disableFakeLock()">
        <div style="font-size:50px;">ğŸ”’</div>
        <p>Double Tap to Unlock</p>
    </div>

    <div id="callOverlay">
        <div class="big-text">ğŸ“ ÎšÎ›Î—Î£Î—!</div>
        <button class="btn-green" style="height: 50vh; font-size: 40px; background: white; color: black;" onclick="acceptCall()">
            Î‘Î ÎŸÎ”ÎŸÎ§Î—
        </button>
    </div>

    <audio id="alertSound" src="alert.mp3" loop></audio>
    <audio id="silentLoop" loop>
        <source src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjIwLjEwMAAAAAAAAAAAAAAA//oeAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAEAAABIADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD//////////////////////////////////8AAAAATGF2YzU4LjM1AAAAAAAAAAAAAAAAJAAAAAAAAAAAASCC8iEAAAAA//oeZAAAAABAAAAA" type="audio/mpeg">
    </audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let wakeLock = null;

        // --- SETUP ---
        function selectRole(role) {
            document.getElementById('roleScreen').classList.remove('active');
            
            if (role === 'sender') {
                document.getElementById('senderScreen').classList.add('active');
            } else {
                document.getElementById('receiverScreen').classList.add('active');
                initReceiverService(); // ÎÎµÎºÎ¹Î½Î¬ÎµÎ¹ Ï„Î¿ "Service"
            }
        }

        // --- LOGIC Î ÎŸÎœÎ ÎŸÎ¥ ---
        function makeCall() {
            socket.emit('call-receiver');
            const btn = document.getElementById('callBtn');
            btn.disabled = true;
            btn.innerText = "ÎšÎ‘Î›Î•Î™...";
            setTimeout(() => {
                btn.disabled = false;
                btn.innerText = "ğŸ”” ÎšÎ›Î—Î£Î—";
            }, 3000);
        }

        // --- LOGIC Î”Î•ÎšÎ¤Î— (SERVICE) ---
        function initReceiverService() {
            // 1. ÎÎµÎºÎ¹Î½Î¬Î¼Îµ Ï„Î¿Î½ ÏƒÎ¹Ï‰Ï€Î·Î»ÏŒ Î®Ï‡Î¿ Î³Î¹Î± Î½Î± Î¼Î·Î½ ÎºÎ¿Î¹Î¼Î·Î¸ÎµÎ¯ Î¿ Chrome
            const silent = document.getElementById('silentLoop');
            silent.volume = 0.01;
            silent.play().catch(e => console.log("Click needed for audio"));

            // 2. Wake Lock API (ÎšÏÎ±Ï„Î¬ÎµÎ¹ Ï„Î·Î½ Î¿Î¸ÏŒÎ½Î· Î±Î½Î¿Î¹Ï‡Ï„Î®)
            requestWakeLock();
        }

        // Î›Î®ÏˆÎ· ÎšÎ»Î®ÏƒÎ·Ï‚
        socket.on('incoming-call', () => {
            // Î‘Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³ÏŒ Ï„Î¿ Fake Lock, Î´ÎµÎ½ Ï„Î¿ ÎºÎ»ÎµÎ¯Î½Î¿Ï…Î¼Îµ, Î±Ï€Î»Î¬ Ï€ÎµÏ„Î¬Î¼Îµ Ï„Î¿ Overlay Î±Ï€ÏŒ Ï€Î¬Î½Ï‰
            // Î¤Î¿ z-index Ï„Î¿Ï… callOverlay ÎµÎ¯Î½Î±Î¹ 2000, Ï„Î¿Ï… fakeLock ÎµÎ¯Î½Î±Î¹ 1000.
            
            document.getElementById('callOverlay').style.display = 'flex';
            
            const sound = document.getElementById('alertSound');
            sound.currentTime = 0;
            sound.volume = 1.0;
            sound.play();

            // Î”ÏŒÎ½Î·ÏƒÎ·
            if(navigator.vibrate) navigator.vibrate([1000, 500, 1000, 500, 1000]);
        });

        // Î‘Ï€Î¿Î´Î¿Ï‡Î® ÎšÎ»Î®ÏƒÎ·Ï‚
        function acceptCall() {
            document.getElementById('callOverlay').style.display = 'none';
            
            const sound = document.getElementById('alertSound');
            sound.pause();
            sound.currentTime = 0;
            
            if(navigator.vibrate) navigator.vibrate(0);
            
            socket.emit('call-accepted');

            // Î‘Î½ ÎµÎ¯Ï‡Î±Î¼Îµ Fake Lock Ï€ÏÎ¹Î½ Ï‡Ï„Ï…Ï€Î®ÏƒÎµÎ¹, Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ Î±Ï€ÏŒ ÎºÎ¬Ï„Ï‰.
            // Î‘Î½ Î¸ÎµÏ‚ Î½Î± Ï†ÎµÏÎ³ÎµÎ¹ ÎºÎ±Î¹ Ï„Î¿ Fake Lock Î¼ÏŒÎ»Î¹Ï‚ Ï„Î¿ ÏƒÎ·ÎºÏÏƒÎµÎ¹Ï‚, Î²Î¬Î»Îµ: disableFakeLock();
        }

        // --- FAKE LOCK LOGIC ---
        // Î‘Ï…Ï„ÏŒ Î±Î½Ï„Î¹ÎºÎ±Î¸Î¹ÏƒÏ„Î¬ Ï„Î¿ ÎºÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï„Î·Ï‚ Î¿Î¸ÏŒÎ½Î·Ï‚.
        function enableFakeLock() {
            // ÎœÏ€Î±Î¯Î½ÎµÎ¹ ÏƒÎµ Ï€Î»Î®ÏÎ· Î¿Î¸ÏŒÎ½Î· Î³Î¹Î± Î½Î± ÎºÏÏÏˆÎµÎ¹ Î¼Ï€Î¬ÏÎµÏ‚
            document.documentElement.requestFullscreen().catch(e=>{});
            document.getElementById('fakeLockLayer').style.display = 'flex';
        }

        function disableFakeLock() {
            if (document.exitFullscreen) document.exitFullscreen();
            document.getElementById('fakeLockLayer').style.display = 'none';
        }

        // --- KEEP AWAKE HACK ---
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Screen Wake Lock Active');
                }
            } catch (err) { console.log(err); }
        }

    </script>
</body>
</html>
