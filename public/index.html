<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BellGo Universal</title>
    <style>
        body { background-color: #000; color: #fff; font-family: sans-serif; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; user-select: none; }
        .btn { padding: 30px; font-size: 24px; border-radius: 15px; width: 90%; margin: 15px; font-weight: bold; border: none; cursor: pointer; color: white; }
        .btn-sender { background-color: #00C853; }
        .btn-receiver { background-color: #2962FF; }
        .btn-stop { background-color: #D50000; display: none; margin-top: 20px; animation: pulse 0.5s infinite; font-size: 30px; height: 50vh; width: 90%; }
        
        #pocketMode { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 9999; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="setupScreen" class="screen" style="display:flex;">
        <h2 style="margin-bottom:30px">BELLGO UNIVERSAL</h2>
        <button class="btn btn-sender" onclick="initMode('sender')">ğŸ”” Î ÎŸÎœÎ ÎŸÎ£</button>
        <button class="btn btn-receiver" onclick="initMode('receiver')">ğŸ‘¨â€ğŸ³ Î”Î•ÎšÎ¤Î—Î£</button>
    </div>

    <div id="senderScreen" class="screen" style="display:none;">
        <button class="btn btn-sender" id="triggerBtn" onclick="sendAlert()">ğŸ”” ÎšÎ›Î—Î£Î—</button>
        <p id="senderStatus" style="color:#888; margin-top:20px;">ÎˆÏ„Î¿Î¹Î¼Î¿</p>
    </div>

    <div id="receiverScreen" class="screen" style="display:none;">
        <div style="font-size: 80px;">ğŸ‘‚</div>
        <h1>Î‘ÎÎ‘ÎœÎŸÎÎ—...</h1>
        <p id="debugText" style="color:yellow; font-size:12px;">(Î Î¬Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¯ Î³Î¹Î± Ï„ÎµÏƒÏ„)</p>
        
        <button class="btn btn-stop" id="stopBtn" onclick="stopAlarm()">ğŸ›‘ STOP</button>
        <button onclick="togglePocketMode(true)" style="margin-top:50px; background:#222; color:#888; border:1px solid #444; padding:15px; border-radius:10px; width:60%;">ğŸ”’ Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î¤ÏƒÎ­Ï€Î·Ï‚</button>
    </div>

    <div id="pocketMode" onclick="togglePocketMode(false)">
        <div style="position:absolute; bottom:50px; width:100%; text-align:center; color:#333; font-size:12px;">Double Tap to Unlock</div>
    </div>

    <audio id="alertPlayer" preload="auto" loop playsinline><source src="alert.mp3" type="audio/mpeg"></audio>
    <script src="/socket.io/socket.io.js"></script>

    <script>
        const socket = io();
        let isRinging = false;
        let vibrationInterval = null;

        // --- ÎšÎ©Î”Î™ÎšÎ‘Î£ Î ÎŸÎ¥ "Î‘ÎšÎŸÎ¥Î•Î™" Î¤Î‘ Î Î‘ÎÎ¤Î‘ ---
        window.addEventListener('keydown', (e) => {
            console.log("Key:", e.key, "Code:", e.keyCode);
            
            // Î•Î¼Ï†Î±Î½Î¯Î¶Î¿Ï…Î¼Îµ ÏƒÏ„Î·Î½ Î¿Î¸ÏŒÎ½Î· Ï„Î¹ Ï€Î±Ï„Î®Î¸Î·ÎºÎµ (Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿)
            if(document.getElementById('receiverScreen').style.display === 'flex') {
                document.getElementById('debugText').innerText = "Î Î±Ï„Î®Î¸Î·ÎºÎµ: " + e.key + " (" + e.keyCode + ")";
            }

            // Î›Î¯ÏƒÏ„Î± Î¼Îµ ÏŒÎ»Î± Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ Media Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€Î±Ï„Î®ÏƒÎµÎ¹Ï‚
            // 176=Next, 177=Previous, 179=Play/Pause, 85=Media, 13=Enter
            if (e.keyCode === 176 || e.keyCode === 177 || e.keyCode === 179 || e.keyCode === 85 || e.key === 'MediaTrackNext' || e.key === 'MediaTrackPrevious' || e.key === 'Enter') {
                
                if (isRinging) {
                    stopAlarm();
                    e.preventDefault(); 
                }
            }
        });

        // --- SETUP ---
        function initMode(mode) {
            document.getElementById('setupScreen').style.display = 'none';
            if (mode === 'sender') {
                document.getElementById('senderScreen').style.display = 'flex';
            } else {
                document.getElementById('receiverScreen').style.display = 'flex';
                setupReceiverLogic();
            }
        }

        function sendAlert() {
            socket.emit('trigger-alarm');
            const btn = document.getElementById('triggerBtn');
            btn.disabled = true;
            btn.innerText = "Î£Î¤Î‘Î›Î˜Î—ÎšÎ•!";
            setTimeout(() => { btn.disabled = false; btn.innerText = "ğŸ”” ÎšÎ›Î—Î£Î—"; }, 2000);
        }

        function setupReceiverLogic() {
            socket.on('ring-bell', () => {
                if(isRinging) return;
                isRinging = true;

                // Audio
                const player = document.getElementById('alertPlayer');
                player.currentTime = 0;
                player.volume = 1.0;
                player.play().catch(e => console.log(e));

                // Vibration Loop
                startVibrationLoop();

                // UI
                document.getElementById('stopBtn').style.display = 'block';
                document.body.style.backgroundColor = '#900';
            });
        }

        function stopAlarm() {
            if(!isRinging) return;
            isRinging = false;
            
            const player = document.getElementById('alertPlayer');
            player.pause();
            player.currentTime = 0;

            stopVibrationLoop();
            
            document.getElementById('stopBtn').style.display = 'none';
            document.body.style.backgroundColor = '#000';
            document.getElementById('debugText').innerText = "Alarm Stopped";
        }

        function startVibrationLoop() {
            if(navigator.vibrate) navigator.vibrate([1000, 200, 1000]);
            if(vibrationInterval) clearInterval(vibrationInterval);
            vibrationInterval = setInterval(() => {
                if(navigator.vibrate) navigator.vibrate([1000, 200, 1000]);
            }, 2500);
        }

        function stopVibrationLoop() {
            if(vibrationInterval) clearInterval(vibrationInterval);
            if(navigator.vibrate) navigator.vibrate(0);
        }

        function togglePocketMode(enable) {
            document.getElementById('pocketMode').style.display = enable ? 'block' : 'none';
        }
    </script>
</body>
</html>
