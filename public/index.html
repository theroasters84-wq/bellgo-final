<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BellGo Media Button</title>
    <style>
        body { background-color: #000; color: #fff; font-family: sans-serif; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; user-select: none; }
        .btn { padding: 30px; font-size: 24px; border-radius: 15px; width: 90%; margin: 10px; font-weight: bold; border: none; cursor: pointer; }
        .btn-sender { background-color: #00C853; color: white; }
        .btn-receiver { background-color: #2962FF; color: white; }
        .btn-stop { background-color: #D50000; display: none; margin-top: 20px; animation: pulse 0.5s infinite; }
        .screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        #setupScreen { display: flex; }
        #pocketMode { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 9999; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="setupScreen" class="screen">
        <h2 style="margin-bottom:30px">RUMBA ALARM</h2>
        <button class="btn btn-sender" onclick="initMode('sender')">ğŸ”” Î£Î•Î¡Î’Î™Î¤ÎŸÎ¡ÎŸÎ£</button>
        <button class="btn btn-receiver" onclick="initMode('receiver')">ğŸ‘¨â€ğŸ³ ÎšÎŸÎ¥Î–Î™ÎÎ‘</button>
    </div>

    <div id="senderScreen" class="screen">
        <button class="btn btn-sender" id="triggerBtn" onclick="sendAlert()">ğŸ”” ÎšÎ›Î—Î£Î—</button>
        <p id="senderStatus" style="color:#888; margin-top:20px;">ÎˆÏ„Î¿Î¹Î¼Î¿</p>
    </div>

    <div id="receiverScreen" class="screen">
        <div style="font-size: 80px;">ğŸ‘‚</div>
        <h1>Î‘ÎÎ‘ÎœÎŸÎÎ—...</h1>
        <button class="btn btn-stop" id="stopBtn" onclick="stopAlarm()">ğŸ”• STOP</button>
        <button onclick="togglePocketMode(true)" style="margin-top:50px; background:#333; color:#aaa; border:none; padding:20px; border-radius:10px; width:80%;">ğŸ”’ Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î¤ÏƒÎ­Ï€Î·Ï‚</button>
    </div>

    <div id="pocketMode" onclick="togglePocketMode(false)">
        <div style="position:absolute; bottom:50px; width:100%; text-align:center; color:#444; font-size:12px;">Double Tap to Unlock</div>
    </div>

    <audio id="alertPlayer" preload="auto" loop playsinline><source src="alert.mp3" type="audio/mpeg"></audio>
    <script src="/socket.io/socket.io.js"></script>

    <script>
        const socket = io();
        let isRinging = false;
        let vibrationInterval = null;

        // --- Î•Î”Î© Î Î™Î‘ÎÎŸÎ¥ÎœÎ• Î¤ÎŸ "PLAY/PAUSE" ---
        window.addEventListener('keydown', (e) => {
            console.log("Key Pressed: ", e.key, e.keyCode);
            
            // Î•Î»Î­Î³Ï‡Î¿Ï…Î¼Îµ Î±Î½ Ï€Î±Ï„Î®Î¸Î·ÎºÎµ Play/Pause (ÎšÏ‰Î´Î¹ÎºÎ¿Î¯ 179, 85) Î® Enter (13)
            // Î¤Î¿ Button Mapper ÏƒÏ„Î­Î»Î½ÎµÎ¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ MediaPlayPause
            if (e.key === 'MediaPlayPause' || e.keyCode === 179 || e.keyCode === 85 || e.keyCode === 13) {
                if (isRinging) {
                    stopAlarm();
                    e.preventDefault(); 
                }
            }
        });

        // --- Rest of Logic ---
        function initMode(mode) {
            document.getElementById('setupScreen').style.display = 'none';
            if (mode === 'sender') {
                document.getElementById('senderScreen').style.display = 'flex';
            } else {
                document.getElementById('receiverScreen').style.display = 'flex';
                setupReceiverLogic();
            }
        }

        function sendAlert() {
            socket.emit('trigger-alarm');
            const btn = document.getElementById('triggerBtn');
            btn.disabled = true;
            btn.innerText = "Î£Î¤Î‘Î›Î˜Î—ÎšÎ•!";
            setTimeout(() => { btn.disabled = false; btn.innerText = "ğŸ”” ÎšÎ›Î—Î£Î—"; }, 2000);
        }

        function setupReceiverLogic() {
            socket.on('ring-bell', () => {
                isRinging = true;
                const player = document.getElementById('alertPlayer');
                player.currentTime = 0;
                player.play();
                startVibration();
                document.getElementById('stopBtn').style.display = 'block';
                document.body.style.backgroundColor = '#900';
            });
        }

        function stopAlarm() {
            isRinging = false;
            const player = document.getElementById('alertPlayer');
            player.pause();
            player.currentTime = 0;
            stopVibration();
            document.getElementById('stopBtn').style.display = 'none';
            document.body.style.backgroundColor = '#000';
        }

        function startVibration() {
            if(navigator.vibrate) {
                if(vibrationInterval) clearInterval(vibrationInterval);
                navigator.vibrate([500, 200, 500, 500]);
                vibrationInterval = setInterval(() => { navigator.vibrate([500, 200, 500, 500]); }, 1700);
            }
        }

        function stopVibration() {
            if(vibrationInterval) clearInterval(vibrationInterval);
            if(navigator.vibrate) navigator.vibrate(0);
        }

        function togglePocketMode(enable) {
            document.getElementById('pocketMode').style.display = enable ? 'block' : 'none';
        }
    </script>
</body>
</html>
