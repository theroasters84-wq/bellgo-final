<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BellGo WEAPONIZED</title>
    <style>
        /* CSS Î“Î™Î‘ ÎœÎ•Î“Î™Î£Î¤Î— Î‘Î ÎŸÎ”ÎŸÎ£Î— */
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: #000; color: #fff; 
            font-family: 'Segoe UI', sans-serif; text-align: center; 
            margin: 0; height: 100vh; overflow: hidden; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* ÎŸÎ˜ÎŸÎÎ•Î£ */
        .screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        /* ÎšÎŸÎ¥ÎœÎ Î™Î‘ */
        .btn { width: 90%; padding: 25px; font-size: 22px; margin: 10px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; color: white; }
        .btn-green { background: #00E676; color: #000; box-shadow: 0 0 15px #00E676; }
        .btn-blue { background: #2962FF; box-shadow: 0 0 15px #2962FF; }
        .btn-dark { background: #222; color: #888; border: 1px solid #444; }

        /* FAKE LOCK (Î— Î Î‘Î“Î™Î”Î‘ Î“Î™Î‘ Î¤ÎŸÎ Î¥Î ÎÎŸ) */
        #fakeLockScreen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 5000; cursor: pointer;
            flex-direction: column; align-items: center; justify-content: center;
        }

        /* ÎŸÎ˜ÎŸÎÎ— ÎšÎ›Î—Î£Î—Î£ (Î¤ÎŸ ÎŸÎ Î›ÎŸ) */
        #alarmScreen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #D50000; z-index: 9999; /* Î Î¬Î½Ï‰ Î±Ï€ÏŒ ÏŒÎ»Î± */
            flex-direction: column; align-items: center; justify-content: center;
            animation: panic 0.2s infinite;
        }

        @keyframes panic { 
            0% { background: #D50000; transform: scale(1); } 
            50% { background: #FF1744; transform: scale(1.02); } 
            100% { background: #D50000; transform: scale(1); } 
        }

        .stop-btn {
            width: 250px; height: 250px; border-radius: 50%;
            background: white; color: red; font-size: 40px; font-weight: 900;
            border: 10px solid yellow; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <div id="loginScreen" class="screen active">
        <h1 style="color:#00E676;">BELLGO V7</h1>
        <button class="btn btn-green" onclick="startSystem('admin')">Î•Î™ÎœÎ‘Î™ ADMIN (Î ÎŸÎœÎ ÎŸÎ£)</button>
        <button class="btn btn-blue" onclick="startSystem('staff')">Î•Î™ÎœÎ‘Î™ STAFF (Î”Î•ÎšÎ¤Î—Î£)</button>
    </div>

    <div id="adminScreen" class="screen">
        <h1>ADMIN PANEL</h1>
        <button class="btn btn-green" id="callBtn" onclick="sendCall()">ğŸ“¢ ÎšÎ›Î—Î£Î— ÎŸÎ›Î©Î</button>
        <p style="color:#888; margin-top:20px;">ÎŸ Î Î¿Î¼Ï€ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î­Ï„Î¿Î¹Î¼Î¿Ï‚.</p>
    </div>

    <div id="staffScreen" class="screen">
        <h1 style="font-size: 50px;">ğŸ§</h1>
        <h2>SYSTEM ARMED</h2>
        
        <div style="margin: 20px 0; font-size: 14px; color: #00E676;">
            ğŸ”Š Audio Engine: ACTIVE<br>
            ğŸ“¡ Socket: CONNECTED
        </div>

        <button class="btn btn-dark" onclick="enableFakeLock()">
            ğŸŒ™ FAKE LOCK (SAFE MODE)
        </button>
        <p style="font-size:12px; color:#555;">ÎœÎ·Î½ ÎºÎ»ÎµÎ¯Î½ÎµÎ¹Ï‚ Ï„Î·Î½ Î¿Î¸ÏŒÎ½Î·. Î Î¬Ï„Î± Ï„Î¿ Fake Lock.</p>
    </div>

    <div id="fakeLockScreen" onclick="disableFakeLock()">
        <div style="color:#333; font-size:12px;">Double Tap to Wake</div>
    </div>

    <div id="alarmScreen">
        <h1 style="font-size:50px; color:white; margin-bottom:20px;">ğŸš¨ ÎšÎ›Î—Î£Î—! ğŸš¨</h1>
        <div class="stop-btn" onclick="stopAlarm()">STOP</div>
        <p style="color:white; font-weight:bold; margin-top:30px;">
            Î Î¬Ï„Î± STOP Î® Volume Up/Down
        </p>
    </div>

    <audio id="alertSound" src="alert.mp3" loop preload="auto"></audio>
    
    <audio id="silentLoop" src="silence.mp3" loop preload="auto"></audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myRole = '';
        let wakeLock = null;
        let fightLoop = null; 

        // --- Î•ÎšÎšÎ™ÎÎ—Î£Î— Î£Î¥Î£Î¤Î—ÎœÎ‘Î¤ÎŸÎ£ ---
        async function startSystem(role) {
            myRole = role;
            
            // 1. Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· "Î£Î¹Ï‰Ï€Î·Î»Î¿Ï ÎšÎ¹Î½Î·Ï„Î®ÏÎ±" (ÎšÏÎ±Ï„Î¬ÎµÎ¹ Ï„Î¿ browser Î¾ÏÏ€Î½Î¹Î¿)
            const silent = document.getElementById('silentLoop');
            silent.volume = 0.05; 
            await silent.play().catch(e => console.log("Click needed for audio"));

            // 2. Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Wake Lock (ÎÎ± Î¼Î·Î½ ÏƒÎ²Î®Î½ÎµÎ¹ Î· Î¿Î¸ÏŒÎ½Î· Î¼ÏŒÎ½Î· Ï„Î·Ï‚)
            if ('wakeLock' in navigator) {
                try { wakeLock = await navigator.wakeLock.request('screen'); } catch(e){}
            }

            // 3. Î£ÏÎ½Î´ÎµÏƒÎ· Socket
            socket.emit('join-store', { storeName: 'General', username: role, role: role });

            // 4. Î‘Î»Î»Î±Î³Î® ÎŸÎ¸ÏŒÎ½Î·Ï‚
            document.getElementById('loginScreen').classList.remove('active');
            if(role === 'admin') document.getElementById('adminScreen').classList.add('active');
            else document.getElementById('staffScreen').classList.add('active');

            // 5. ÎŸÎ Î›Î™Î£ÎœÎŸÎ£ MEDIA SESSION (Î“Î¹Î± Î½Î± Ï€Î¹Î¬Î½Î¿Ï…Î½ Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬)
            setupMediaSession("BellGo Standby");
        }

        // --- MEDIA SESSION (Î§Î•Î™Î¡Î™Î£ÎœÎŸÎ£ ÎšÎŸÎ¥ÎœÎ Î™Î©Î) ---
        function setupMediaSession(state) {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: state,
                    artist: 'System Online',
                    album: 'Do Not Close'
                });

                // ÎŒÎ»Î± Ï„Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ ÎºÎ¬Î½Î¿Ï…Î½ STOP Ï„Î¿Î½ ÏƒÏ…Î½Î±Î³ÎµÏÎ¼ÏŒ
                const actionHandler = () => {
                    if(document.getElementById('alarmScreen').style.display === 'flex') {
                        stopAlarm();
                    }
                };
                navigator.mediaSession.setActionHandler('play', actionHandler);
                navigator.mediaSession.setActionHandler('pause', actionHandler);
                navigator.mediaSession.setActionHandler('stop', actionHandler);
                navigator.mediaSession.setActionHandler('previoustrack', actionHandler);
                navigator.mediaSession.setActionHandler('nexttrack', actionHandler);
            }
        }

        // --- SEND CALL (ADMIN) ---
        function sendCall() {
            socket.emit('trigger-alarm', { targetId: null });
            const btn = document.getElementById('callBtn');
            btn.style.background = "#555";
            btn.innerText = "ÎšÎ‘Î›Î•Î™...";
            setTimeout(() => { btn.style.background = "#00E676"; btn.innerText = "ğŸ“¢ ÎšÎ›Î—Î£Î— ÎŸÎ›Î©Î"; }, 2000);
        }

        // --- RECEIVE CALL (STAFF) ---
        socket.on('ring-bell', () => {
            if(myRole === 'admin') return;

            // 1. Î Î•Î¤Î‘Î“ÎœÎ‘Î¤Î‘Î™ Î— ÎŸÎ˜ÎŸÎÎ— ÎšÎ›Î—Î£Î—Î£
            document.getElementById('alarmScreen').style.display = 'flex';
            
            // 2. Î—Î§ÎŸÎ£ Î£Î¥ÎÎ‘Î“Î•Î¡ÎœÎŸÎ¥
            const alertSnd = document.getElementById('alertSound');
            alertSnd.currentTime = 0;
            alertSnd.volume = 1.0;
            alertSnd.play();

            // 3. Î‘Î›Î›Î‘Î“Î— MEDIA SESSION (Î“Î¹Î± Î½Î± Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Lock Screen)
            setupMediaSession("ğŸš¨ ÎšÎ›Î—Î£Î— Î‘Î ÎŸ ÎšÎŸÎ¥Î–Î™ÎÎ‘! ğŸš¨");

            // 4. Î”ÎŸÎÎ—Î£Î—
            if(navigator.vibrate) navigator.vibrate([1000, 200, 1000, 200, 1000]);

            // 5. FULLY KIOSK FORCE (Î‘Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹)
            if(window.fully) {
                fully.turnScreenOn();
                fully.bringToForeground();
                // Loop Î³Î¹Î± Î½Î± ÎµÏ€Î¹Î¼Î­Î½ÎµÎ¹
                if(fightLoop) clearInterval(fightLoop);
                fightLoop = setInterval(() => {
                    fully.bringToForeground();
                    fully.turnScreenOn();
                }, 800);
            }
        });

        // --- STOP ALARM ---
        function stopAlarm() {
            document.getElementById('alarmScreen').style.display = 'none';
            
            const alertSnd = document.getElementById('alertSound');
            alertSnd.pause();
            alertSnd.currentTime = 0;

            if(navigator.vibrate) navigator.vibrate(0);
            if(fightLoop) clearInterval(fightLoop);

            setupMediaSession("BellGo Standby");
        }

        // --- FAKE LOCK ---
        function enableFakeLock() {
            document.getElementById('fakeLockScreen').style.display = 'flex';
            // Î–Î·Ï„Î¬Î¼Îµ Full Screen Î³Î¹Î± Î½Î± ÎºÏÏÏˆÎ¿Ï…Î¼Îµ Ï„Î¹Ï‚ Î¼Ï€Î¬ÏÎµÏ‚
            if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
        }
        function disableFakeLock() {
            document.getElementById('fakeLockScreen').style.display = 'none';
            if(document.exitFullscreen) document.exitFullscreen();
        }
    </script>
</body>
</html>
