<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BellGo Hybrid</title>
    
    <style>
        body { background: #000; color: white; font-family: sans-serif; text-align: center; height: 100vh; display: flex; flex-direction: column; justify-content: center; overflow: hidden; }
        .btn { padding: 20px; width: 80%; font-size: 20px; margin: 10px; border-radius: 15px; border: none; font-weight: bold; cursor: pointer; }
        .btn-green { background: #00E676; color: black; }
        .btn-blue { background: #2962FF; color: white; }
        .status { font-size: 14px; color: #666; margin-top: 20px; }
        
        /* ALARM OVERLAY */
        #alarmScreen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: red; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; animation: flash 0.5s infinite; }
        @keyframes flash { 0% { background: red; } 50% { background: #500; } 100% { background: red; } }
        .stop-btn { width: 200px; height: 200px; border-radius: 50%; background: white; color: red; font-size: 30px; font-weight: 900; border: 5px solid yellow; }
    </style>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>
</head>
<body>

    <div id="loginSection">
        <h1>BELLGO v10</h1>
        <p id="deviceType" style="color: cyan;">Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Î£Ï…ÏƒÎºÎµÏ…Î®Ï‚...</p>
        <button class="btn btn-blue" onclick="startApp('staff')">Î•Î™ÎœÎ‘Î™ Î”Î•ÎšÎ¤Î—Î£ (TABLET)</button>
        <button class="btn btn-green" onclick="startApp('admin')">Î•Î™ÎœÎ‘Î™ Î ÎŸÎœÎ ÎŸÎ£</button>
    </div>

    <div id="mainScreen" style="display:none;">
        <h2 id="roleText">...</h2>
        <p id="connectionStatus">ðŸ”´ Disconnected</p>
        <button id="fireBtn" class="btn btn-green" style="display:none;" onclick="triggerAlarm()">ðŸ”” ÎšÎ›Î—Î£Î—</button>
        <div id="logs" class="status"></div>
    </div>

    <div id="alarmScreen">
        <h1>ðŸš¨ ÎšÎ›Î—Î£Î—!</h1>
        <button class="stop-btn" onclick="stopAlarm()">STOP</button>
    </div>

    <audio id="siren" src="alert.mp3" loop></audio>
    <audio id="silence" src="silence.mp3" loop></audio>

    <script>
        const socket = io();
        let isFully = typeof fully !== 'undefined'; // Î•Î´ÏŽ ÎºÎ±Ï„Î±Î»Î±Î²Î±Î¯Î½Î¿Ï…Î¼Îµ Î±Î½ ÎµÎ¯Î¼Î±ÏƒÏ„Îµ ÏƒÏ„Î¿ Fully Kiosk
        let messaging = null;
        let myToken = null;

        // --- 1. Î‘ÎÎ™Î§ÎÎ•Î¥Î£Î— Î£Î¥Î£ÎšÎ•Î¥Î—Î£ ---
        const deviceLabel = document.getElementById('deviceType');
        if (isFully) {
            deviceLabel.innerText = "ðŸ¤– Mode: Fully Kiosk (Native Control)";
            // Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Fully Kiosk Î³Î¹Î± Î½Î± Î¼Î·Î½ ÎºÎ¿Î¹Î¼Î¬Ï„Î±Î¹
            fully.setBooleanSetting("keepScreenOn", true);
            fully.setBooleanSetting("unlockScreen", true);
        } else {
            deviceLabel.innerText = "ðŸŒ Mode: Standard Browser (Chrome)";
        }

        // --- 2. FIREBASE SETUP (ÎœÎŸÎÎŸ Î“Î™Î‘ CHROME) ---
        // Î‘Î½ ÎµÎ¯Î¼Î±ÏƒÏ„Îµ Fully Kiosk ÎºÎ±Î¹ Î²Î³Î¬Î¶ÎµÎ¹ error, Ï„Î¿ Ï€ÏÎ¿ÏƒÏ€ÎµÏÎ½Î¬Î¼Îµ!
        if (!isFully) {
            const firebaseConfig = {
                apiKey: "AIzaSyBDOAlwLn4P5PMlwkg_Hms6-4f9fEcBKn8",
                authDomain: "bellgo-5dbe5.firebaseapp.com",
                projectId: "bellgo-5dbe5",
                storageBucket: "bellgo-5dbe5.firebasestorage.app",
                messagingSenderId: "799314495253",
                appId: "1:799314495253:web:baf6852f2a065c3a2e8b1c",
                measurementId: "G-379ETZJP8H"
            };
            try {
                firebase.initializeApp(firebaseConfig);
                messaging = firebase.messaging();
                console.log("Firebase initialized for Chrome.");
            } catch(e) { console.log("Firebase skipped."); }
        }

        // --- 3. Î•ÎšÎšÎ™ÎÎ—Î£Î— ---
        async function startApp(role) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'block';
            document.getElementById('roleText').innerText = role === 'admin' ? "Î ÎŸÎœÎ ÎŸÎ£" : "Î”Î•ÎšÎ¤Î—Î£";

            // Î‘Î½ ÎµÎ¯Î½Î±Î¹ Chrome Î”Î­ÎºÏ„Î·Ï‚, Ï€Î¬ÏÎµ Token. Î‘Î½ ÎµÎ¯Î½Î±Î¹ Fully, Î¼Î·Î½ Î±ÏƒÏ‡Î¿Î»Î·Î¸ÎµÎ¯Ï‚.
            if (role === 'staff' && !isFully && messaging) {
                try {
                    myToken = await messaging.getToken();
                    console.log("Token:", myToken);
                } catch(e) { console.log("Token failed or denied"); }
            }

            if (role === 'admin') document.getElementById('fireBtn').style.display = 'block';
            
            // Î Î±Î¯Î¾Îµ ÏƒÎ¹Ï‰Ï€Î® Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ»ÎµÎ¹Î´ÏŽÏƒÎµÎ¹ Î¿ Î®Ï‡Î¿Ï‚
            document.getElementById('silence').play().catch(()=>{});

            // Î£ÏÎ½Î´ÎµÏƒÎ· ÏƒÏ„Î¿Î½ Server
            socket.emit('join-store', {
                storeName: 'MainStore',
                username: role,
                role: role,
                fcmToken: myToken,
                device: isFully ? 'fully' : 'chrome' // Î›Î­Î¼Îµ ÏƒÏ„Î¿Î½ Server Ï„Î¹ ÎµÎ¯Î¼Î±ÏƒÏ„Îµ
            });
        }

        // --- 4. ÎŸÎ¤Î‘Î Î§Î¤Î¥Î Î‘Î•Î™ (Î— ÎšÎ‘Î¡Î”Î™Î‘ Î¤ÎŸÎ¥ Î£Î¥Î£Î¤Î—ÎœÎ‘Î¤ÎŸÎ£) ---
        socket.on('ring-bell', () => {
            console.log("âš¡ ALARM TRIGGERED!");

            // Î‘. Î•ÎœÎ¦Î‘ÎÎ™Î£Î—
            document.getElementById('alarmScreen').style.display = 'flex';
            
            // Î’. Î—Î§ÎŸÎ£
            const audio = document.getElementById('siren');
            audio.currentTime = 0;
            audio.play();

            // Î“. Î•Î™Î”Î™ÎšÎŸÎ£ Î§Î•Î™Î¡Î™Î£ÎœÎŸÎ£ FULLY KIOSK (Î•Î´ÏŽ ÎµÎ¯Î½Î±Î¹ Î· Î¼Î±Î³ÎºÎ¹Î¬)
            if (isFully) {
                fully.turnScreenOn();        // Î†Î½Î±ÏˆÎµ Î¿Î¸ÏŒÎ½Î·
                fully.bringToForeground();   // ÎˆÎ»Î± Î¼Ï€ÏÎ¿ÏƒÏ„Î¬
                fully.showToast("ðŸš¨ ÎšÎ›Î—Î£Î— ÎšÎŸÎ¥Î–Î™ÎÎ‘Î£!"); // ÎœÎ®Î½Ï…Î¼Î±
                fully.setMusicVolume(100);   // Î¤Î­ÏÎ¼Î± Î®Ï‡Î¿Ï‚
                
                // Î”ÏŒÎ½Î·ÏƒÎ· Î¼Î­ÏƒÏ‰ Fully
                // fully.vibrate(); // (Î‘Î½ Ï„Î¿ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ tablet)
            }
        });

        // --- 5. Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î•Î£ ---
        function triggerAlarm() {
            socket.emit('trigger-alarm');
        }

        function stopAlarm() {
            document.getElementById('alarmScreen').style.display = 'none';
            document.getElementById('siren').pause();
            if (isFully) fully.turnScreenOff(); // Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ: ÏƒÎ²Î®Î½ÎµÎ¹ Î¿Î¸ÏŒÎ½Î· Î¼ÎµÏ„Î¬ Ï„Î¿ Stop
        }

        // Status Updates
        socket.on('connect', () => { 
            document.getElementById('connectionStatus').innerText = "ðŸŸ¢ Connected (" + (isFully ? "Fully" : "Web") + ")";
            document.getElementById('connectionStatus').style.color = "#00E676";
        });
        socket.on('disconnect', () => {
            document.getElementById('connectionStatus').innerText = "ðŸ”´ Disconnected";
            document.getElementById('connectionStatus').style.color = "red";
        });

    </script>
</body>
</html>

