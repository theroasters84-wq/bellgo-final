<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BellGo COMMANDO</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            background-color: #000; 
            color: #fff; 
            font-family: sans-serif; 
            text-align: center; 
            display: flex; flex-direction: column; 
            height: 100vh; margin: 0; overflow: hidden; 
            padding: 10px;
        }

        .screen { display: none; flex-direction: column; height: 100%; width: 100%; justify-content: center; }
        
        input { padding: 15px; margin: 10px 0; width: 100%; font-size: 20px; text-align: center; background: #222; color: #fff; border: 1px solid #444; border-radius: 10px; }
        
        .btn { padding: 20px; font-size: 22px; width: 100%; margin: 10px 0; font-weight: bold; border: none; border-radius: 10px; color: white; }
        .btn-green { background: #00C853; }
        .btn-blue { background: #2962FF; }
        
        /* Î¤Î•Î¡Î‘Î£Î¤Î™ÎŸ ÎšÎŸÎ¥ÎœÎ Î™ STOP - ÎšÎ‘Î›Î¥Î Î¤Î•Î™ Î¤Î‘ Î Î‘ÎÎ¤Î‘ */
        .alarm-overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: red; z-index: 99999; flex-direction: column; 
            align-items: center; justify-content: center;
            animation: flash 0.2s infinite;
        }
        
        .btn-stop { width: 90%; height: 60%; font-size: 50px; background: white; color: red; font-weight: 900; border: 10px solid yellow; border-radius: 20px; }

        @keyframes flash { 0% { background: red; } 50% { background: #500; } 100% { background: red; } }
        
        .status-bar { font-size: 12px; color: #0f0; margin-top: 20px; border: 1px solid #0f0; padding: 5px; }
    </style>
</head>
<body>

    <div id="loginScreen" class="screen" style="display:flex;">
        <h1 style="color:#00C853;">BELLGO COMMANDO</h1>
        <input type="text" id="storeName" placeholder="ÎŒÎ½Î¿Î¼Î± ÎœÎ±Î³Î±Î¶Î¹Î¿Ï">
        <input type="text" id="username" placeholder="ÎŒÎ½Î¿Î¼Î± Î§ÏÎ®ÏƒÏ„Î·">
        <button class="btn btn-blue" onclick="startApp('staff')">Î•Î™Î£ÎŸÎ”ÎŸÎ£ (Î Î¡ÎŸÎ£Î©Î Î™ÎšÎŸ)</button>
        <button class="btn btn-green" onclick="startApp('admin')">Î•Î™Î£ÎŸÎ”ÎŸÎ£ (ADMIN)</button>
    </div>

    <div id="appScreen" class="screen">
        <h2 id="welcomeText">Î‘Î½Î±Î¼Î¿Î½Î®...</h2>
        <div class="status-bar" id="statusText">System Offline</div>

        <button class="btn btn-green" id="adminBtn" style="display:none;" onclick="triggerAlarm()">ğŸ”” ÎšÎ›Î—Î£Î— ÎŸÎ›Î©Î</button>
        
        <button class="btn" style="background:#333; margin-top:auto;" onclick="fakeSleep()">ğŸŒ™ SAFE SCREEN OFF</button>
    </div>

    <div id="alarmOverlay" class="alarm-overlay">
        <h1 style="color:white; margin-bottom:20px;">ğŸš¨ ÎšÎ›Î—Î£Î—! ğŸš¨</h1>
        <button class="btn-stop" onclick="stopAlarm()">STOP</button>
    </div>

    <audio id="alertSound" src="alert.mp3" loop preload="auto"></audio>
    <audio id="silentLoop" loop>
        <source src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjIwLjEwMAAAAAAAAAAAAAAA//oeAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAEAAABIADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD//////////////////////////////////8AAAAATGF2YzU4LjM1AAAAAAAAAAAAAAAAJAAAAAAAAAAAASCC8iEAAAAA//oeZAAAAABAAAAA" type="audio/mpeg">
    </audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myRole = '';
        let isRinging = false;
        let fightLoop = null; // Î— Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® Î³Î¹Î± Ï„Î¿Î½ "ÎºÎ±Ï…Î³Î¬" Î¼Îµ Ï„Î¿ Android

        function startApp(role) {
            const store = document.getElementById('storeName').value;
            const user = document.getElementById('username').value;
            if(!store || !user) return alert("Î’Î¬Î»Îµ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±!");

            // 1. ÎÎµÎºÎ¹Î½Î¬Î¼Îµ Ï„Î¿ Silent Audio (ÎšÎ¡Î‘Î¤Î‘Î•Î™ Î¤ÎŸ CPU ÎÎ¥Î ÎÎ™ÎŸ)
            document.getElementById('silentLoop').play().catch(e=>console.log(e));
            
            // 2. Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Fully (Î‘Î½ Ï„ÏÎ­Ï‡ÎµÎ¹ ÎµÎºÎµÎ¯)
            if(window.fully) {
                fully.setBooleanSetting("keepScreenOn", true);
                fully.setBooleanSetting("unlockScreen", true);
                fully.setBooleanSetting("turnScreenOn", true);
                fully.setBooleanSetting("foregroundOnActivity", true);
            }

            socket.emit('join-store', { storeName: store, username: user, role: role });
            
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appScreen').style.display = 'flex';
            document.getElementById('welcomeText').innerText = user;
            document.getElementById('statusText').innerText = "âœ… SYSTEM ACTIVE & LISTENING";

            if(role === 'admin') document.getElementById('adminBtn').style.display = 'block';
            myRole = role;
        }

        // --- H ÎšÎ‘Î¡Î”Î™Î‘ Î¤ÎŸÎ¥ Î£Î¥Î£Î¤Î—ÎœÎ‘Î¤ÎŸÎ£ ---
        socket.on('ring-bell', () => {
            if(isRinging) return;
            isRinging = true;

            // 1. ÎÎ¥Î ÎÎ‘ Î¤Î‘ Î Î‘ÎÎ¤Î‘
            if(window.fully) {
                fully.turnScreenOn();       // Î†Î½Î±ÏˆÎµ Î¿Î¸ÏŒÎ½Î·
                fully.bringToForeground();  // ÎˆÎ»Î± Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î¿ Instagram
                fully.setMusicVolume(100);  // Î¤Î­ÏÎ¼Î± Î®Ï‡Î¿Ï‚
            }

            // 2. ÎÎ•ÎšÎ™ÎÎ‘ Î¤ÎŸÎ "ÎšÎ‘Î¥Î“Î‘" (FIGHT LOOP)
            // ÎšÎ¬Î¸Îµ 0.5 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±, Ï€ÎµÏ„Î¬Î³ÎµÏ„Î±Î¹ Î¼Ï€ÏÎ¿ÏƒÏ„Î¬, ÏŒ,Ï„Î¹ ÎºÎ±Î¹ Î½Î± ÎºÎ¬Î½ÎµÎ¹ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚
            if(window.fully) {
                if(fightLoop) clearInterval(fightLoop);
                fightLoop = setInterval(() => {
                    fully.bringToForeground();
                    fully.turnScreenOn();
                    console.log("BOOM! Bringing to front...");
                }, 500); 
            }

            // 3. UI & SOUND & VIBRATE
            document.getElementById('alarmOverlay').style.display = 'flex';
            document.getElementById('alertSound').currentTime = 0;
            document.getElementById('alertSound').play();
            
            // Î”ÏŒÎ½Î·ÏƒÎ·: 1 Î´ÎµÏ…Ï„, Ï€Î±ÏÏƒÎ·, 1 Î´ÎµÏ…Ï„ (ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±)
            navigator.vibrate([1000, 200, 1000, 200, 1000, 200, 1000]); 
        });

        function stopAlarm() {
            isRinging = false;
            
            // Î£Ï„Î±Î¼Î±Ï„Î¬Î¼Îµ Ï„Î¿ Loop Ï€Î¿Ï… Ï„Î¿ Ï†Î­ÏÎ½ÎµÎ¹ Î¼Ï€ÏÎ¿ÏƒÏ„Î¬
            if(fightLoop) { clearInterval(fightLoop); fightLoop = null; }
            
            document.getElementById('alarmOverlay').style.display = 'none';
            document.getElementById('alertSound').pause();
            navigator.vibrate(0); // Î£Ï„Î±Î¼Î±Ï„Î¬ÎµÎ¹ Î· Î´ÏŒÎ½Î·ÏƒÎ·
        }

        // ADMIN TRIGGER
        function triggerAlarm() {
            socket.emit('trigger-alarm', { targetId: null }); // Null = ÎŒÎ»Î¿Î¹
        }

        // FAKE SLEEP (Î“Î¹Î± Î½Î± Î¼Î·Î½ ÎºÎ»ÎµÎ¯Î½Î¿Ï…Î½ Ï„Î·Î½ Î¿Î¸ÏŒÎ½Î· Î±Ï€ÏŒ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯)
        function fakeSleep() {
            if(window.fully) {
                fully.startScreensaver(); // Î¡ÏÎ¸Î¼Î¹ÏƒÎµ Ï„Î¿ screensaver ÏƒÏ„Î¿ Fully Î½Î± ÎµÎ¯Î½Î±Î¹ Î¼Î±ÏÏÎ¿
            }
        }
        
        // VOLUME BUTTON STOP (Hardware Button)
        window.addEventListener('keydown', (e) => {
            if(isRinging) {
                stopAlarm();
            }
        });
    </script>
</body>
</html>
