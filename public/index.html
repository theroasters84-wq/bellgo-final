<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Media Bar Test Full</title>
<style>
body { background:#000; color:#fff; font-family:sans-serif; text-align:center; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; margin:0; }
#status { margin-top:20px; font-size:18px; color:yellow; border:1px solid #333; padding:10px; width:90%; }
</style>
</head>
<body>

<h1>Media Bar Auto Test</h1>
<div id="status">Î‘Î½Î±Î¼Î¿Î½Î®...</div>

<!-- ÎŸ Î®Ï‡Î¿Ï‚ Î³Î¹Î± media bar -->
<audio id="silence" src="alert.mp3" loop preload="auto"></audio>

<script>
// =====================
// Helpers
// =====================
const status = document.getElementById('status');
const log = t => status.innerHTML = t + "<br>" + status.innerHTML;

async function startAudio() {
    const audio = document.getElementById('silence');
    audio.volume = 0.5;

    try {
        await audio.play();
        log("âœ… Î‰Ï‡Î¿Ï‚ Ï€Î±Î¯Î¶ÎµÎ¹!");
        setupMediaSession();
    } catch(e){
        log("âš ï¸ Play Error: "+e.message);
        log("Î§ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ user gesture Î® Fully Kiosk hack.");
    }
}

// =====================
// MediaSession setup
// =====================
function setupMediaSession(){
    if('mediaSession' in navigator){
        navigator.mediaSession.metadata = new MediaMetadata({
            title:"Auto Alert Test",
            artist:"Kitchen System",
            album:"MediaBar",
            artwork:[{src:"https://cdn-icons-png.flaticon.com/512/727/727245.png",sizes:"512x512",type:"image/png"}]
        });

        try{
            navigator.mediaSession.setPositionState({
                duration:600, // 10 Î»ÎµÏ€Ï„Î¬
                position:0,
                playbackRate:1.0
            });
            log("âœ… PositionState set (10 Î»ÎµÏ€Ï„Î¬)");
        }catch(e){ log("âš ï¸ PositionState Error: "+e.message); }

        navigator.mediaSession.playbackState = "playing";
        log("ğŸ‘‰ Î¤ÏÏÎ± ÏƒÏÏÎµ Ï„Î·Î½ Î¿Î¸ÏŒÎ½Î· Î±Ï€ÏŒ Ï€Î¬Î½Ï‰! Î— media bar Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯.");
    }else{
        log("âŒ MediaSession Not Supported");
    }
}

// =====================
// Watchdog Î³Î¹Î± Î½Î± ÎºÏÎ±Ï„Î¬ÎµÎ¹ Ï„Î·Î½ bar Î¶Ï‰Î½Ï„Î±Î½Î®
// =====================
const Watchdog = {
    interval:null,
    ensureAudioPlaying:function(){
        const audio = document.getElementById('silence');
        if(audio && audio.paused) audio.play().catch(()=>{});
    },
    start:function(){
        if(this.interval) clearInterval(this.interval);
        this.interval = setInterval(()=>this.ensureAudioPlaying(),5000);
    }
};

// =====================
// Fully Kiosk hack / dummy gesture
// =====================
window.addEventListener('load', ()=>{
    if(typeof fully !== 'undefined'){
        // Fully Kiosk: ÎºÎ¬Î½Î¿Ï…Î¼Îµ dummy tap Î³Î¹Î± autoplay
        fully.injectJavascript('document.getElementById("silence").play();');
        log("âœ… Fully Kiosk dummy play injected");
        setTimeout(startAudio, 1000);
    } else {
        // Browser: Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€Î±Ï„Î®ÏƒÎµÎ¹ user gesture, Î±Î»Î»Î¹ÏÏ‚ ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÎ¹ error
        startAudio();
    }

    // Start watchdog
    Watchdog.start();
});
</script>

</body>
</html>
