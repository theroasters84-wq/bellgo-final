<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BellGo Live</title>
    <style>
        body { background-color: #121212; color: white; font-family: sans-serif; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .btn { padding: 20px 40px; font-size: 24px; border: none; border-radius: 10px; margin: 10px; cursor: pointer; width: 80%; max-width: 300px; touch-action: manipulation; }
        .btn-sender { background-color: #4CAF50; color: white; }
        .btn-receiver { background-color: #2196F3; color: white; }
        .btn-stop { background-color: #f44336; color: white; display: none; margin-top: 20px; }
        .mode-select { display: flex; flex-direction: column; gap: 20px; }
        .active-screen { display: none; width: 100%; }
        #status { margin-top: 15px; color: #888; font-size: 0.9em; }
    </style>
</head>
<body>

    <div id="setupScreen" class="mode-select">
        <h2>BellGo System</h2>
        <button class="btn btn-sender" onclick="initMode('sender')">Î ÎŸÎœÎ ÎŸÎ£ ğŸ””</button>
        <button class="btn btn-receiver" onclick="initMode('receiver')">Î”Î•ÎšÎ¤Î—Î£ ğŸ‘‚</button>
        <p style="color: #666; font-size: 12px;">v2.0 Socket.io</p>
    </div>

    <div id="senderScreen" class="active-screen">
        <h1>Î ÎŸÎœÎ ÎŸÎ£</h1>
        <button class="btn btn-sender" id="triggerBtn" onclick="sendAlert()">ğŸ”” Î§Î¤Î¥Î Î‘ Î¤ÎŸ</button>
        <p id="senderStatus">Î£Ï…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿</p>
    </div>

    <div id="receiverScreen" class="active-screen">
        <h1>Î”Î•ÎšÎ¤Î—Î£</h1>
        <div style="font-size: 60px;">ğŸ‘‚</div>
        <p>Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÎ®Î¼Î±Ï„Î¿Ï‚...</p>
        <div style="color: orange; font-size: 12px;">ğŸ”Š Î’ÎµÎ²Î±Î¹ÏÏƒÎ¿Ï… ÏŒÏ„Î¹ Î· Î­Î½Ï„Î±ÏƒÎ· ÎµÎ¯Î½Î±Î¹ Ï„Î­ÏÎ¼Î±</div>
        <button class="btn btn-stop" id="stopBtn" onclick="stopAlarm()">ğŸ”• STOP</button>
    </div>

    <audio id="silencePlayer" loop playsinline>
        <source src="silence.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="alertPlayer" preload="auto">
        <source src="alert.mp3" type="audio/mpeg">
    </audio>

    <script src="/socket.io/socket.io.js"></script>

    <script>
        // Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î¿Î½ Server (Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î²ÏÎ¯ÏƒÎºÎµÎ¹ Ï„Î¿ URL Ï„Î¿Ï… Render)
        const socket = io();
        let wakeLock = null;

        // --- ANTI-SLEEP LOGIC ---
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake Lock active');
                }
            } catch (err) { console.log('Wake Lock error', err); }
        }

        function startSilenceLoop() {
            const silence = document.getElementById('silencePlayer');
            silence.volume = 0.01; 
            // Î¤Î¿ play Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î³Î¯Î½ÎµÎ¹ Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ user interaction
            silence.play().then(() => {
                console.log("Audio loop started");
                requestWakeLock();
            }).catch(e => console.log("Audio requires interaction"));
        }

        // --- APP LOGIC ---
        function initMode(mode) {
            document.getElementById('setupScreen').style.display = 'none';
            
            // ÎÎµÎºÎ¹Î½Î¬Î¼Îµ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Anti-Sleep
            startSilenceLoop(); 

            if (mode === 'sender') {
                document.getElementById('senderScreen').style.display = 'block';
            } else {
                document.getElementById('receiverScreen').style.display = 'block';
                setupReceiver();
            }
        }

        // Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î ÎŸÎœÎ ÎŸÎ¥
        function sendAlert() {
            const btn = document.getElementById('triggerBtn');
            btn.disabled = true;
            btn.innerText = "Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î—...";

            // Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Î¼Î®Î½Ï…Î¼Î± ÏƒÏ„Î¿Î½ Server
            socket.emit('trigger-alarm');

            setTimeout(() => {
                btn.disabled = false;
                btn.innerText = "ğŸ”” Î§Î¤Î¥Î Î‘ Î¤ÎŸ";
                document.getElementById('senderStatus').innerText = "Î£Ï„Î¬Î»Î¸Î·ÎºÎµ ÏƒÏ„Î¹Ï‚ " + new Date().toLocaleTimeString();
            }, 1000);
        }

        // Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î”Î•ÎšÎ¤Î—
        function setupReceiver() {
            // ÎŒÏ„Î±Î½ Î¿ Server Î¼Î±Ï‚ Ï€ÎµÎ¹ "ring-bell"
            socket.on('ring-bell', () => {
                console.log("ALARM RECEIVED!");
                const alertPlayer = document.getElementById('alertPlayer');
                const stopBtn = document.getElementById('stopBtn');
                
                alertPlayer.currentTime = 0;
                alertPlayer.volume = 1.0;
                alertPlayer.play().catch(e => alert("Î Î±Ï„Î®ÏƒÏ„Îµ ÏƒÏ„Î·Î½ Î¿Î¸ÏŒÎ½Î· Î³Î¹Î± Î½Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÏ„Îµ Ï„Î¿Î½ Î®Ï‡Î¿!"));
                
                stopBtn.style.display = 'block';
                document.body.style.backgroundColor = 'red';
                
                // Î”ÏŒÎ½Î·ÏƒÎ· Î±Î½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÏ„Î±Î¹
                if (navigator.vibrate) navigator.vibrate([500, 200, 500, 200, 500]);
            });
        }

        function stopAlarm() {
            const alertPlayer = document.getElementById('alertPlayer');
            alertPlayer.pause();
            alertPlayer.currentTime = 0;
            document.getElementById('stopBtn').style.display = 'none';
            document.body.style.backgroundColor = '#121212';
        }

        // Log connection status
        socket.on('connect', () => {
            console.log("Î£Ï…Î½Î´Î­Î¸Î·ÎºÎµ ÏƒÏ„Î¿ Socket.io");
        });
    </script>
</body>
</html>
