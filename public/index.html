<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BellGo System</title>
    <style>
        /* Î’Î±ÏƒÎ¹ÎºÏŒ Î£Ï„Ï…Î» - Dark Mode */
        body { background-color: #121212; color: #ffffff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; user-select: none; }
        
        /* ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ */
        .btn { padding: 25px; font-size: 22px; border: none; border-radius: 12px; margin: 15px; cursor: pointer; width: 85%; max-width: 350px; font-weight: bold; touch-action: manipulation; transition: transform 0.1s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .btn:active { transform: scale(0.96); }
        .btn-sender { background-color: #00C853; color: white; } /* Î ÏÎ¬ÏƒÎ¹Î½Î¿ */
        .btn-receiver { background-color: #2962FF; color: white; } /* ÎœÏ€Î»Îµ */
        .btn-stop { background-color: #D50000; color: white; display: none; margin-top: 30px; animation: pulse 1s infinite; }
        .btn-fake-lock { background-color: #424242; color: #aaa; font-size: 14px; padding: 10px; width: auto; margin-top: 40px; }
        .btn-logout { position: absolute; top: 10px; right: 10px; background: transparent; color: #666; border: 1px solid #444; padding: 5px 10px; font-size: 12px; border-radius: 5px; cursor: pointer; }

        /* ÎŸÎ¸ÏŒÎ½ÎµÏ‚ */
        .screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        #setupScreen { display: flex; } /* Î‘ÏÏ‡Î¹ÎºÎ® Î¿Î¸ÏŒÎ½Î· */

        /* Fake Lock (Black Screen) */
        #fakeLockOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: black; z-index: 9999; touch-action: none; }
        #fakeLockText { position: absolute; bottom: 20px; width: 100%; text-align: center; color: #222; font-size: 12px; }

        /* Animation Î³Î¹Î± Ï„Î¿ Alarm */
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .alarm-active { background-color: #ff0000 !important; }
    </style>
</head>
<body>

    <div id="setupScreen" class="screen">
        <h2 style="margin-bottom: 40px;">BellGo System</h2>
        <button class="btn btn-sender" onclick="initMode('sender')">ğŸ”” Î ÎŸÎœÎ ÎŸÎ£ (Waiter)</button>
        <button class="btn btn-receiver" onclick="initMode('receiver')">ğŸ‘‚ Î”Î•ÎšÎ¤Î—Î£ (Kitchen)</button>
        <p style="color: #444; margin-top: 50px; font-size: 12px;">v2.0 Socket Connected</p>
    </div>

    <div id="senderScreen" class="screen">
        <button class="btn-logout" onclick="location.reload()">Exit</button>
        <h1>Î ÎŸÎœÎ ÎŸÎ£</h1>
        <button class="btn btn-sender" id="triggerBtn" onclick="sendAlert()">ğŸ”” ÎšÎ›Î—Î£Î—</button>
        <p id="senderStatus" style="color: #888; margin-top: 20px;">ÎˆÏ„Î¿Î¹Î¼Î¿</p>
    </div>

    <div id="receiverScreen" class="screen">
        <button class="btn-logout" onclick="location.reload()">Exit</button>
        <h1>Î”Î•ÎšÎ¤Î—Î£</h1>
        <div style="font-size: 80px; margin: 20px;">ğŸ‘‚</div>
        <p style="color: #aaa;">Î£ÏÎ½Î´ÎµÏƒÎ· Î•Î½ÎµÏÎ³Î®</p>
        
        <button class="btn btn-stop" id="stopBtn" onclick="stopAlarm()">ğŸ”• STOP ALARM</button>

        <button class="btn btn-fake-lock" onclick="toggleFakeLock(true)">ğŸ”’ Black Screen (Save Battery)</button>
    </div>

    <div id="fakeLockOverlay" onclick="toggleFakeLock(false)">
        <div id="fakeLockText">Tap anywhere to unlock</div>
    </div>

    <audio id="silencePlayer" loop playsinline>
        <source src="silence.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="alertPlayer" preload="auto" playsinline>
        <source src="alert.mp3" type="audio/mpeg">
    </audio>

    <script src="/socket.io/socket.io.js"></script>

    <script>
        const socket = io();
        let wakeLock = null;
        let heartbeatInterval = null;
let vibrationInterval = null;

function startVibration() {
    // Hack: Î•Î»Î­Î³Ï‡Î¿Ï…Î¼Îµ Î±Î½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÏ„Î±Î¹
    if (navigator.vibrate) {
        // ÎšÎ¬Î½Î¿Ï…Î¼Îµ ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒ Î±Î½ Ï„ÏÎ­Ï‡ÎµÎ¹ Î®Î´Î·
        if (vibrationInterval) clearInterval(vibrationInterval);

        // ÎÎµÎºÎ¹Î½Î¬Î¼Îµ Ï„Î· Î´ÏŒÎ½Î·ÏƒÎ· Î±Î¼Î­ÏƒÏ‰Ï‚
        navigator.vibrate([500, 300, 500, 300]);

        // ÎšÎ±Î¹ Ï„Î·Î½ ÎµÏ€Î±Î½Î±Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ ÎºÎ¬Î¸Îµ 1.6 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î± (ÏŒÏƒÎ¿ Î´Î¹Î±ÏÎºÎµÎ¯ Ï„Î¿ pattern)
        vibrationInterval = setInterval(() => {
            navigator.vibrate([500, 300, 500, 300]);
        }, 1600);
    }
}

function stopVibration() {
    if (vibrationInterval) {
        clearInterval(vibrationInterval);
        vibrationInterval = null;
    }
    // Î£Ï„Î±Î¼Î±Ï„Î¬ÎµÎ¹ Î±ÎºÎ±ÏÎ¹Î±Î¯Î± Ï„Î· Î´ÏŒÎ½Î·ÏƒÎ·
    if (navigator.vibrate) navigator.vibrate(0); 
}
        // --- 1. ANTI-SLEEP MECHANISMS ---
        async function enableAntiSleep() {
            // A. Audio Loop Hack
            const silence = document.getElementById('silencePlayer');
            silence.volume = 0.01; 
            try {
                await silence.play();
                console.log("Silent loop playing...");
            } catch (err) {
                console.log("Audio play failed (waiting for interaction)");
            }

            // B. Wake Lock API (Screen)
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log("WakeLock Active");
                }
            } catch (err) { console.log("WakeLock Error:", err); }

            // C. Heartbeat (Ping Server every 30s)
            if (heartbeatInterval) clearInterval(heartbeatInterval);
            heartbeatInterval = setInterval(() => {
                if (socket.connected) socket.emit('keep-alive');
            }, 30000);
        }

        // --- 2. INITIALIZATION ---
        function initMode(mode) {
            // Î–Î·Ï„Î¬Î¼Îµ Anti-Sleep Î¼Îµ Ï„Î¿ Ï€ÏÏÏ„Î¿ ÎºÎ»Î¹Îº
            enableAntiSleep();

            // Î‘Î»Î»Î±Î³Î® UI
            document.getElementById('setupScreen').style.display = 'none';
            
            if (mode === 'sender') {
                document.getElementById('senderScreen').style.display = 'flex';
            } else {
                document.getElementById('receiverScreen').style.display = 'flex';
                setupReceiverLogic();
            }
        }

        // --- 3. SENDER LOGIC ---
        function sendAlert() {
            const btn = document.getElementById('triggerBtn');
            btn.disabled = true;
            btn.innerText = "Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î—...";
            btn.style.opacity = "0.7";

            socket.emit('trigger-alarm');

            // Feedback & Reset ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï
            setTimeout(() => {
                btn.disabled = false;
                btn.innerText = "ğŸ”” ÎšÎ›Î—Î£Î—";
                btn.style.opacity = "1";
                document.getElementById('senderStatus').innerText = "Î£Ï„Î¬Î»Î¸Î·ÎºÎµ: " + new Date().toLocaleTimeString();
            }, 1500);
        }

        // --- 4. RECEIVER LOGIC ---
        function setupReceiverLogic() {
            socket.on('ring-bell', () => {
                console.log("ALARM RECEIVED!");
                
                // Î‘Î½ ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Black Screen, Î¾ÏÏ€Î½Î± Ï„Î¿ UI (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ, ÎµÎ´Ï Ï„Î¿ Î±Ï†Î®Î½Ï‰ Î¼Î±ÏÏÎ¿ Î±Î»Î»Î¬ Ï€Î±Î¯Î¶ÎµÎ¹ Î®Ï‡Î¿)
                // toggleFakeLock(false); // ÎÎµ-ÏƒÏ‡Î¿Î»Î¯Î±ÏƒÎµ Î±Î½ Î¸ÎµÏ‚ Î½Î± Î±Î½Î¬Î²ÎµÎ¹ Î· Î¿Î¸ÏŒÎ½Î· Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±

                const alertPlayer = document.getElementById('alertPlayer');
                const stopBtn = document.getElementById('stopBtn');

                // Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î®Ï‡Î¿Ï…
                alertPlayer.currentTime = 0;
                alertPlayer.volume = 1.0;
                alertPlayer.play().catch(e => console.log("Sound blocked:", e));

                // Visual Cues
                document.body.classList.add('alarm-active');
                stopBtn.style.display = 'block';

                // Î”ÏŒÎ½Î·ÏƒÎ· (Î±Î½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÏ„Î±Î¹)
                if (navigator.vibrate) navigator.vibrate([1000, 500, 1000]);
            });
        }

        function stopAlarm() {
            const alertPlayer = document.getElementById('alertPlayer');
            alertPlayer.pause();
            alertPlayer.currentTime = 0;
            
            document.body.classList.remove('alarm-active');
            document.getElementById('stopBtn').style.display = 'none';
        }

        // --- 5. FAKE LOCK (BLACK SCREEN) ---
        function toggleFakeLock(enable) {
            const overlay = document.getElementById('fakeLockOverlay');
            if (enable) {
                overlay.style.display = 'block';
                // Î ÏÎ¿ÏƒÏ€Î±Î¸Î¿ÏÎ¼Îµ Î½Î± Î¼Ï€Î¿ÏÎ¼Îµ ÏƒÎµ Full Screen Î³Î¹Î± Î½Î± ÎºÏÏÏˆÎ¿Ï…Î¼Îµ ÎºÎ±Î¹ Ï„Î·Î½ Î¼Ï€Î¬ÏÎ± URL
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen().catch(e=>{});
                }
            } else {
                overlay.style.display = 'none';
                if (document.exitFullscreen) {
                    document.exitFullscreen().catch(e=>{});
                }
            }
        }
    </script>
</body>
</html>

