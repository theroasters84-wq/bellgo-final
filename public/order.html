<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content, viewport-fit=cover">
    
    <title>Delivery</title>
    <link rel="icon" type="image/png" href="/shop.png">
    <link rel="apple-touch-icon" href="/shop.png">
    
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Delivery">

    <link rel="manifest" id="dynamicManifest">
    <link rel="stylesheet" href="/style.css">

    <script src="https://js.stripe.com/v3/"></script>
    <script src="/socket.io/socket.io.js"></script>

    <script>
        (function() {
            // Î”Ï…Î½Î±Î¼Î¹ÎºÎ® ÎµÏÏÎµÏƒÎ· Ï„Î¿Ï… Store Î±Ï€ÏŒ Ï„Î¿ URL Path Î® Ï„Î¿ Query String
            let store = "";
            const pathParts = window.location.pathname.split('/');
            // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ ÎµÎ¯Î¼Î±ÏƒÏ„Îµ ÏƒÎµ URL Î¼Î¿ÏÏ†Î®Ï‚ /shop/storeName/
            if (pathParts.includes('shop') && pathParts.length > 2) { 
                store = decodeURIComponent(pathParts[pathParts.indexOf('shop') + 1]); // âœ… FIX: Î‘Ï€Î¿ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·
            } else if (pathParts.includes('dinein') && pathParts.length > 2) {
                // âœ… Support Dine-In Route
                store = decodeURIComponent(pathParts[pathParts.indexOf('dinein') + 1]);
            } else {
                // Fallback ÏƒÎµ query string ?store=xyz
                const params = new URLSearchParams(window.location.search);
                store = params.get('store');
                
                // âœ… FIX: Force redirect to /shop/ structure if accessed via /order.html
                // This ensures PWA scope is correct and independent
                if (store && !window.location.pathname.includes('/shop/') && !window.location.pathname.includes('/dinein/')) {
                     window.location.replace(`/shop/${encodeURIComponent(store)}/${window.location.search}`);
                     return;
                }
            }

            const manifestLink = document.getElementById('dynamicManifest');
            if (store) {
                // Î–Î·Ï„Î¬Î¼Îµ Î´Ï…Î½Î±Î¼Î¹ÎºÏŒ manifest Î³Î¹Î± Î±Ï…Ï„ÏŒ Ï„Î¿ store
                // Î¤Î¿ /manifest.json route Ï„Î¿Ï… server Î¸Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ Ï„Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ start_url & scope
                manifestLink.href = `/manifest.json?icon=shop&store=${encodeURIComponent(store)}`;
            } else {
                manifestLink.href = `/manifest.json?icon=shop`;
            }
        })();
    </script>
</head>
<body>

    <div id="loginScreen" style="display:none;">
        <h1>BellGo Delivery ğŸ›µ</h1>
        <p data-i18n="login_to_order">Î£Ï…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±Î³Î³ÎµÎ¯Î»ÎµÏ„Îµ</p>
        <button class="btn-google" onclick="App.loginGoogle()">
            <span style="font-weight:900; font-size:24px; margin-right:8px;">G</span> <span data-i18n="login_with_google">Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Google</span>
        </button>
        <button id="btnInstallLogin" class="btn-install-app" onclick="App.installPWA()"><span data-i18n="install_app">ğŸ“² Î•Î“ÎšÎ‘Î¤Î‘Î£Î¤Î‘Î£Î— APP</span></button>
    </div>

    <!-- âœ… NEW: CHOICE MODAL (Delivery Only) -->
    <div id="choiceModal" class="overlay-screen" style="display:none; z-index: 12000;">
        <div class="details-box" style="text-align:center;">
            <h3 style="color:#FFD700; margin-bottom:20px;" data-i18n="what_would_you_like">Î¤Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ;</h3>
            <button class="btn-save-details" onclick="App.chooseAction('order')" style="margin-bottom:15px; background:#2196F3;">ğŸ›µ <span data-i18n="order_delivery">Î Î‘Î¡Î‘Î“Î“Î•Î›Î™Î‘ DELIVERY</span></button>
            <button class="btn-save-details" onclick="App.chooseAction('book')" style="background:#9C27B0;">ğŸ“… <span data-i18n="book_table">ÎšÎ¡Î‘Î¤Î—Î£Î— Î¤Î¡Î‘Î Î•Î–Î™ÎŸÎ¥</span></button>
            <button class="btn-save-details" onclick="App.openMyReservations()" style="background:#333; margin-top:15px; font-size:14px;">ğŸ“‹ ÎŸÎ™ ÎšÎ¡Î‘Î¤Î—Î£Î•Î™Î£ ÎœÎŸÎ¥</button>
        </div>
    </div>

    <div id="detailsOverlay" class="overlay-screen">
        <div class="details-box">
            <h3 style="color:#FFD700; margin:0;" id="detailsTitle" data-i18n="welcome"> ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ!</h3>
            
            <!-- Delivery Fields -->
            <div id="deliveryFields">
                <input type="text" id="inpName" class="inp-detail" placeholder="Î¤Î¿ ÎŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚" data-i18n-placeholder="your_name">
                <input type="text" id="inpAddress" class="inp-detail" placeholder="Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· (Ï€.Ï‡. Î•ÏÎ¼Î¿Ï 15)" data-i18n-placeholder="address_placeholder">
                <input type="text" id="inpFloor" class="inp-detail" placeholder="ÎŒÏÎ¿Ï†Î¿Ï‚ / ÎšÎ¿Ï…Î´Î¿ÏÎ½Î¹" data-i18n-placeholder="floor_bell">
                <input type="tel" id="inpPhone" class="inp-detail" placeholder="Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚" data-i18n-placeholder="contact_phone">
                <input type="text" id="inpZip" class="inp-detail" placeholder="Î¤.Îš. (Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)" data-i18n-placeholder="zip_optional">
            </div>
            <!-- Dine-In Fields -->
            <div id="dineInFields" style="display:none;">
                <div id="tableDisplay" style="color:#00E676; font-weight:bold; margin-bottom:15px; font-size:22px;"></div>
                <div style="color:#aaa; font-size:14px; margin-bottom:5px;" data-i18n="number_of_people">Î‘Î¡Î™Î˜ÎœÎŸÎ£ Î‘Î¤ÎŸÎœÎ©Î</div>
                <input type="number" id="inpCovers" class="inp-detail" placeholder="Ï€.Ï‡. 4" value="1" inputmode="numeric" style="text-align:center; font-size:20px; width:80px; margin:0 auto;">
            </div>

            <button class="btn-save-details" onclick="App.saveDetails()" data-i18n="continue">Î£Î¥ÎÎ•Î§Î•Î™Î‘</button>
        </div>
    </div>

    <div id="paymentOverlay" class="overlay-screen">
        <div class="details-box">
            <h3 style="color:#FFD700;" data-i18n="payment_method">Î¤ÏÏŒÏ€Î¿Ï‚ Î Î»Î·ÏÏ‰Î¼Î®Ï‚</h3>
            <button class="btn-pay" id="payCash" onclick="App.confirmPayment('ğŸ’µ ÎœÎ•Î¤Î¡Î—Î¤Î‘')">ğŸ’µ <span data-i18n="cash">ÎœÎ•Î¤Î¡Î—Î¤Î‘</span></button>
            <button class="btn-pay" id="payCard" onclick="App.confirmPayment('ğŸ’³ ÎšÎ‘Î¡Î¤Î‘')">ğŸ’³ <span data-i18n="card">ÎšÎ‘Î¡Î¤Î‘</span></button>
            <button onclick="document.getElementById('paymentOverlay').style.display='none'" style="background:transparent; border:none; color:#aaa; margin-top:15px; font-size:14px; cursor:pointer;" data-i18n="cancel">Î‘ÎšÎ¥Î¡Î©Î£Î—</button>
        </div>
    </div>
    
    <div id="closedOverlay" class="store-closed-overlay">
        <div class="closed-text" data-i18n="closed">ğŸ”´ ÎšÎ›Î•Î™Î£Î¤ÎŸ</div>
        <p style="color:#aaa;" data-i18n="store_not_accepting_orders">Î¤Î¿ ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± Î´ÎµÎ½ Î´Î­Ï‡ÎµÏ„Î±Î¹ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯ÎµÏ‚ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.</p>
    </div>
    
    <div id="scheduleViewModal" class="overlay-screen" onclick="document.getElementById('scheduleViewModal').style.display='none'">
        <div class="details-box" onclick="event.stopPropagation()">
            <h3 style="color:#FFD700; margin:0; margin-bottom:15px;" data-i18n="delivery_schedule">ğŸ“… Î©ÏÎ¬ÏÎ¹Î¿ Î”Î¹Î±Î½Î¿Î¼Î®Ï‚</h3>
            <div id="scheduleList" style="width:100%;"></div>
            <button onclick="document.getElementById('scheduleViewModal').style.display='none'" style="background:transparent; border:none; color:#aaa; margin-top:15px; cursor:pointer;" data-i18n="close">ÎšÎ›Î•Î™Î£Î™ÎœÎŸ</button>
        </div>
    </div>

    <div id="userExtrasModal" class="overlay-screen">
        <div class="details-box">
            <h3 style="color:#FFD700; margin:0;" id="userExtrasTitle" data-i18n="options">Î•Ï€Î¹Î»Î¿Î³Î­Ï‚</h3>
            <div id="userExtrasList" class="extras-grid"></div>
            <button class="btn-save-details" onclick="App.confirmExtras()" data-i18n="add">Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—</button>
            <button onclick="document.getElementById('userExtrasModal').style.display='none'" style="background:transparent; border:none; color:#aaa; margin-top:10px; cursor:pointer;" data-i18n="cancel">Î‘ÎšÎ¥Î¡Î©Î£Î—</button>
        </div>
    </div>

    <!-- âœ… NEW: BOOKING MODAL -->
    <div id="bookingModal" class="overlay-screen">
        <div class="details-box">
            <h3 style="color:#9C27B0; margin:0;" data-i18n="book_table">ğŸ“… ÎšÎ¡Î‘Î¤Î—Î£Î— Î¤Î¡Î‘Î Î•Î–Î™ÎŸÎ¥</h3>
            <div style="display:flex; flex-direction:column; gap:10px; margin-top:15px;">
                <input type="date" id="inpBookDate" class="inp-detail" style="text-align:center;">
                <input type="time" id="inpBookTime" class="inp-detail" style="text-align:center;">
                <input type="number" id="inpBookPax" class="inp-detail" placeholder="Î†Ï„Î¿Î¼Î±" style="text-align:center;">
                <input type="tel" id="inpBookPhone" class="inp-detail" placeholder="Î¤Î·Î»Î­Ï†Ï‰Î½Î¿" style="text-align:center;">
                <input type="text" id="inpBookName" class="inp-detail" placeholder="ÎŒÎ½Î¿Î¼Î±" style="text-align:center;">
            </div>
            <button class="btn-save-details" onclick="App.submitReservation()" style="background:#9C27B0; margin-top:15px;" data-i18n="confirm_booking">ÎšÎ¡Î‘Î¤Î—Î£Î—</button>
            <button onclick="document.getElementById('bookingModal').style.display='none'" style="background:transparent; border:none; color:#aaa; margin-top:10px; cursor:pointer;" data-i18n="cancel">Î‘ÎšÎ¥Î¡Î©Î£Î—</button>
        </div>
    </div>

    <!-- âœ… NEW: MY RESERVATIONS MODAL -->
    <div id="myReservationsModal" class="overlay-screen" style="z-index: 13000;">
        <div class="details-box">
            <h3 style="color:#9C27B0; margin:0;">ğŸ“‹ ÎŸÎ™ ÎšÎ¡Î‘Î¤Î—Î£Î•Î™Î£ ÎœÎŸÎ¥</h3>
            <div id="myReservationsList" style="margin-top:15px; max-height:300px; overflow-y:auto; width:100%;"></div>
            <button onclick="App.closeMyReservations()" style="background:transparent; border:none; color:#aaa; margin-top:10px; cursor:pointer;">ÎšÎ›Î•Î™Î£Î™ÎœÎŸ</button>
        </div>
    </div>

    <div id="appContent" style="display:none;">
        <div class="header">
            <div class="header-left">
                <button id="btnStatusMini" class="btn-status-mini" onclick="App.maximizeStatus()">
                    â³ <span id="miniStatusText">...</span>
                </button>
            </div>

            <div class="store-info">
                <span id="storeNameHeader">...</span>
            </div>
            <div class="header-actions">
                 <div class="lang-switcher">
                    <span id="lang-el" class="lang-option active" onclick="App.setLanguage('el')">EL</span>
                    <span id="lang-en" class="lang-option" onclick="App.setLanguage('en')">EN</span>
                </div>
                <button id="btnReview" class="btn-header-install" style="display:none; background:#FFD700; color:black; margin-right:5px;" onclick="App.openReview()">â­ <span data-i18n="review">Î‘ÎÎ™ÎŸÎ›ÎŸÎ“Î—Î£Î—</span></button>
                <button id="btnHeaderMyRes" class="btn-header-install" style="display:none; background:#333; color:white; margin-right:5px; align-items:center; gap:5px;" onclick="App.openMyReservations()">ğŸ½ï¸ <span style="font-size:10px;">ÎšÎ¡Î‘Î¤Î—Î£Î•Î™Î£</span></button>
                <button id="btnInstallHeader" class="btn-header-install" onclick="App.installPWA()">ğŸ“² <span data-i18n="app">APP</span></button>
            </div>
        </div>

        <div id="menuContainer">
            <div style="text-align:center; color:#555; margin-top:50px;" data-i18n="loading_menu">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï…...</div>
        </div>

        <div id="orderPanel" class="order-panel minimized">
            <div class="panel-header-bar" onclick="App.toggleOrderPanel()">
                <div style="font-size:12px; color:#aaa; margin-right:10px;" data-i18n="cart_submit">ÎšÎ‘Î›Î‘Î˜Î™ / Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î— <span id="cartBadge" class="cart-badge" style="display:none">0</span></div>
                <div id="panelIcon" class="toggle-icon">â–²</div>
            </div>
            <div class="panel-content">
                <div class="address-bar">
                    <span id="displayAddress">...</span>
                    <!-- âœ… NEW: BOOKING BUTTON -->
                    <button id="btnMyRes" onclick="App.openMyReservations()" style="display:none; background:#333; color:white; border:none; padding:5px 10px; border-radius:5px; margin-left:5px; cursor:pointer; font-weight:bold;">ğŸ½ï¸</button>
                    <button id="btnBookTable" onclick="App.openBookingModal()" style="display:none; background:#9C27B0; color:white; border:none; padding:5px 10px; border-radius:5px; margin-left:5px; cursor:pointer; font-weight:bold;">ğŸ“… ÎšÎ¡Î‘Î¤Î—Î£Î—</button>
                    <button class="btn-edit" onclick="App.editDetails()">âœï¸ <span data-i18n="change">Î‘Î»Î»Î±Î³Î®</span></button>
                </div>
                
                <textarea id="orderText" class="order-text" 
                    placeholder="Î“ÏÎ¬ÏˆÏ„Îµ ÎµÎ´Ï...&#10;(âš ï¸ Î“Î¹Î± Ï€Î»Î·ÏÏ‰Î¼Î® Î¼Îµ ÎšÎ‘Î¡Î¤Î‘, ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î± Î±Ï€ÏŒ Ï„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿!)" 
                    data-i18n-placeholder="write_here_card_warning"
                    oninput="App.handleInput()">
                </textarea>
                
                <div id="liveTotal" data-i18n="total_zero">Î£Î¥ÎÎŸÎ›ÎŸ: 0.00â‚¬</div>

                <button id="btnSendOrder" class="btn-send" onclick="App.requestPayment()"><span data-i18n="send_order">Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î— Î Î‘Î¡Î‘Î“Î“Î•Î›Î™Î‘Î£</span> ğŸš€</button>
            </div>
        </div>

        <div id="statusOverlay">
            <div class="status-content">
                <h2 style="color:#FFD700; margin-top:0;" data-i18n="order_status">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î Î±ÏÎ±Î³Î³ÎµÎ»Î¹ÏÎ½</h2>
                <div id="orderStatusList" style="width:100%; overflow-y:auto; max-height:60vh; padding:5px;"></div>
                <button class="btn-minimize" onclick="App.minimizeStatus()" style="margin-top:20px; width:100%; padding:15px; background:#333; color:white; border:none; border-radius:10px; font-weight:bold;" data-i18n="back_to_menu">â–¼ Î Î™Î£Î© Î£Î¤ÎŸ ÎœÎ•ÎÎŸÎ¥</button>
            </div>
        </div>
    </div>

    <script type="module" src="/order.js"></script>
</body>
</html>