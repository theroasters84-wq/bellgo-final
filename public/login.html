<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BellGo Login</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: #121212; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100dvh; width: 100vw; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .btn-apk-landing { position: absolute; top: 20px; right: 20px; text-decoration: none; color: #00E676; border: 1px solid #00E676; padding: 8px 12px; border-radius: 20px; font-size: 13px; font-weight: bold; background: rgba(0,0,0,0.5); z-index: 200; backdrop-filter: blur(4px); }
        h1 { margin-bottom: 30px; color: #00E676; font-size: 32px; }
        .role-switch { display: flex; gap: 10px; margin-bottom: 20px; }
        .role-btn { padding: 10px 20px; border: 1px solid #444; background: #222; color: white; border-radius: 20px; cursor: pointer; }
        .role-btn.active { background: #00E676; color: black; font-weight: bold; border-color: #00E676; }
        .login-form { width: 85%; display: flex; flex-direction: column; gap: 12px; }
        input, select { width: 100%; padding: 15px; background: #222; border: 1px solid #444; color: white; border-radius: 8px; font-size: 16px; text-align: center; }
        .btn-login { width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 5px; transition: opacity 0.2s; }
        .btn-login:active { opacity: 0.8; }
        .btn-google { width: 100%; padding: 15px; background: #DB4437; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 5px; }
        .divider { text-align:center; margin: 5px 0; color:#444; font-size: 14px; }
        
        /* ÎÎ•Î‘ Î£Î¤Î¥Î› Î“Î™Î‘ Î•Î Î™Î›ÎŸÎ“Î— Î Î‘ÎšÎ•Î¤ÎŸÎ¥ */
        .plan-btn { width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .plan-basic { background: #2196F3; color: white; }
        .plan-premium { background: #FFD700; color: black; border: 2px solid #FFA000; }
        .plan-desc { font-size: 12px; opacity: 0.9; font-weight: normal; margin-top: 4px; }
    </style>
</head>
<body>
    <a href="https://github.com/theroasters84-wq/bellgo-final/releases/latest/download/app-release.apk" class="btn-apk-landing" target="_blank">ğŸ“² APP</a>

    <h1>ğŸ”” BellGo</h1>

    <div class="role-switch">
        <button class="role-btn active" id="btnRoleStaff" onclick="UI.showStaffLogin()">Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ</button>
        <button class="role-btn" id="btnRoleAdmin" onclick="UI.showAdminLogin()">Admin</button>
    </div>

    <div id="staffForm" class="login-form">
        <input type="email" id="inpStoreEmail" placeholder="Email Î•Ï€Î¹Ï‡ÎµÎ¯ÏÎ·ÏƒÎ·Ï‚ (Admin)">
        <input type="text" id="inpMyName" placeholder="Î¤Î¿ ÎŒÎ½Î¿Î¼Î¬ ÏƒÎ¿Ï…">
        <select id="inpMyRole">
            <option value="waiter">ğŸŸ¦ Î£ÎµÏÎ²Î¹Ï„ÏŒÏÎ¿Ï‚</option>
            <option value="driver">ğŸŸ¥ Î”Î¹Î±Î½Î¿Î¼Î­Î±Ï‚</option>
        </select>
        <button class="btn-login" style="background: #00E676; color: black;" onclick="App.loginStaff()">Î£Î¥ÎÎ”Î•Î£Î—</button>
    </div>

    <div id="adminForm" class="login-form" style="display:none;">
        <div id="defaultAdminView">
            <p style="text-align:center; color:#ccc; font-size:14px; margin-bottom:5px;">Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î•Ï€Î¹Ï‡ÎµÎ¯ÏÎ·ÏƒÎ·Ï‚</p>
            
            <input type="email" id="inpAdminManualEmail" placeholder="Email Î•Ï€Î¹Ï‡ÎµÎ¯ÏÎ·ÏƒÎ·Ï‚">
            
            <button class="btn-login" style="background: #00E676; color: black;" onclick="App.loginAdminManual()">Î•Î™Î£ÎŸÎ”ÎŸÎ£</button>

            <button class="btn-login" style="background: #9C27B0; color: white;" onclick="App.redirectToStripe()">ğŸ’³ Î Î›Î—Î¡Î©ÎœÎ—</button>

            <div class="divider">Î®</div>

            <button class="btn-google" onclick="App.loginAdminGoogle()"><span>G</span> Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Google</button>
        </div>
        
        <div id="paymentOptionsView" style="display:none;">
            <p style="text-align:center; color:white; margin-bottom:15px;">âš ï¸ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ ÎµÎ½ÎµÏÎ³Î® ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®.<br>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€Î±ÎºÎ­Ï„Î¿:</p>
            
            <button class="plan-btn plan-basic" onclick="App.pay('basic')">
                <span>ğŸ”¹ BASIC (4â‚¬)</span>
                <span class="plan-desc">Î‘Ï€Î»ÏŒ ÎšÎ¿Ï…Î´Î¿ÏÎ½Î¹ (Waiters/Drivers)</span>
            </button>

            <button class="plan-btn plan-premium" onclick="App.pay('premium')">
                <span>ğŸ‘‘ PREMIUM (10â‚¬)</span>
                <span class="plan-desc">Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯ÎµÏ‚, ÎœÎµÎ½Î¿Ï & Î•Ï†Î±ÏÎ¼Î¿Î³Î® Î ÎµÎ»Î¬Ï„Î·</span>
            </button>
            
            <button onclick="location.reload()" style="background:none; border:none; color:#777; width:100%; margin-top:10px; cursor:pointer;">Î Î¯ÏƒÏ‰</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Stripe API Key
        const stripe = Stripe('pk_test_51SwnsPJcEtNSGviLKOxO4p4VbPFFETxpAN84nX0fmYAPrSVGRaeLdLnMc5WmYtYVeErvgIxKyzYJED4Q6aIv7WV9002gRiPOay');

        const firebaseConfig = { 
            apiKey: "AIzaSyBDOAlwLn4P5PMlwkg_Hms6-4f9fEcBKn8", 
            authDomain: "bellgo-5dbe5.firebaseapp.com", 
            projectId: "bellgo-5dbe5", 
            storageBucket: "bellgo-5dbe5.firebasestorage.app", 
            messagingSenderId: "799314495253", 
            appId: "1:799314495253:web:baf6852f2a065c3a2e8b1c"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· email Î³Î¹Î± Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚
        let currentEmail = "";

        window.UI = {
            showStaffLogin: () => {
                document.getElementById('btnRoleStaff').classList.add('active');
                document.getElementById('btnRoleAdmin').classList.remove('active');
                document.getElementById('staffForm').style.display = 'flex';
                document.getElementById('adminForm').style.display = 'none';
            },
            showAdminLogin: () => {
                document.getElementById('btnRoleStaff').classList.remove('active');
                document.getElementById('btnRoleAdmin').classList.add('active');
                document.getElementById('staffForm').style.display = 'none';
                document.getElementById('adminForm').style.display = 'flex';
            },
            showPaymentOptions: (email) => {
                currentEmail = email;
                document.getElementById('defaultAdminView').style.display = 'none';
                document.getElementById('paymentOptionsView').style.display = 'block';
            }
        };

        window.App = {
            // --- Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· & Redirect ---
            saveAndRedirect: (user, forceUrl) => {
                user.store = user.store.toLowerCase().trim();
                localStorage.setItem('bellgo_session', JSON.stringify(user));
                
                // Î‘Î½ Î´ÎµÎ½ Î´Î¿Î¸ÎµÎ¯ URL, Ï€Î·Î³Î±Î¯Î½Î¿Ï…Î¼Îµ ÏƒÏ„Î¿ index.html (Î³Î¹Î± Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ)
                window.location.href = forceUrl || "index.html";
            },

            // --- Î›ÎŸÎ“Î™ÎšÎ— Î•Î›Î•Î“Î§ÎŸÎ¥ Î Î›Î—Î¡Î©ÎœÎ—Î£ & VERSION ---
            checkSubscriptionAndProceed: async (email, name, role) => {
                try {
                    const res = await fetch('/check-subscription', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ email })
                    });
                    const data = await res.json();

                    if (data.active) {
                        // Î•ÎÎ•Î¡Î“Î— Î£Î¥ÎÎ”Î¡ÎŸÎœÎ— -> Î•Î›Î•Î“Î§ÎŸÎ£ Î Î‘ÎšÎ•Î¤ÎŸÎ¥
                        const user = { store: email, name, role, plan: data.plan };
                        
                        if (data.plan === 'premium') {
                            // Î‘Î½ ÎµÎ¯Î½Î±Î¹ premium -> Î Î®Î³Î±Î¹Î½Îµ ÏƒÏ„Î¿ Super App
                            App.saveAndRedirect(user, "premium.html");
                        } else {
                            // Î‘Î½ ÎµÎ¯Î½Î±Î¹ basic -> Î Î®Î³Î±Î¹Î½Îµ ÏƒÏ„Î¿ ÎšÎ»Î±ÏƒÎ¹ÎºÏŒ App
                            App.saveAndRedirect(user, "index.html");
                        }
                    } else {
                        // Î‘ÎÎ•ÎÎ•Î¡Î“Î— -> Î•ÎœÎ¦Î‘ÎÎ™Î£Î— Î•Î Î™Î›ÎŸÎ“Î©Î
                        UI.showPaymentOptions(email);
                    }
                } catch (e) {
                    alert("Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î¼Îµ Ï„Î¿Î½ server. Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.");
                }
            },

            // --- Î Î›Î—Î¡Î©ÎœÎ— ÎœÎ• Î•Î Î™Î›ÎŸÎ“Î— ---
            pay: async (planType) => {
                if (!currentEmail) return alert("Î£Ï†Î¬Î»Î¼Î± Email");
                
                try {
                    const stripeRes = await fetch('/create-checkout-session', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        // Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Ï„Î¿ email ÎºÎ±Î¹ Ï„Î¿ planType (Î±Î½ ÎºÎ±Î¹ Ï„Î¿ PriceID ÎµÎ¯Î½Î±Î¹ Î¯Î´Î¹Î¿ Ï€ÏÎ¿Ï‚ Ï„Î¿ Ï€Î±ÏÏŒÎ½)
                        body: JSON.stringify({ email: currentEmail, planType: planType })
                    });
                    
                    const session = await stripeRes.json();
                    
                    if (session.id) {
                        stripe.redirectToCheckout({ sessionId: session.id });
                    } else {
                        alert("Î£Ï†Î¬Î»Î¼Î± Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚: " + (session.error || "Î†Î³Î½Ï‰ÏƒÏ„Î¿"));
                    }
                } catch (e) {
                    alert("Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.");
                }
            },

            // Î“Î¹Î± Ï„Î¿ Î¼Ï‰Î² ÎºÎ¿Ï…Î¼Ï€Î¯ (Direct Default Payment)
            redirectToStripe: () => {
                const email = document.getElementById('inpAdminManualEmail').value.trim();
                if (!email || !email.includes('@')) {
                    return alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î¿ Email ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·ÏƒÎ·Ï‚.");
                }
                currentEmail = email;
                App.pay('basic'); // Default basic
            },

            // Login Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¿Ï (Î Î¬Î½Ï„Î± Ï€Î¬ÎµÎ¹ ÏƒÏ„Î¿ Index - Basic View)
            // Î£Î—ÎœÎ•Î™Î©Î£Î—: Î‘Î½ Î¿ Admin ÎµÎ¯Î½Î±Î¹ Premium, Ï„Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ Î¸Î± Î´ÎµÎ¹ Ï„Î¿ Premium Index
            // Î±Î½ Î±Î»Î»Î¬Î¾Î¿Ï…Î¼Îµ Ï„Î¿ index.html Î±ÏÎ³ÏŒÏ„ÎµÏÎ±. Î ÏÎ¿Ï‚ Ï„Î¿ Ï€Î±ÏÏŒÎ½ Ï€Î¬ÎµÎ¹ ÏƒÏ„Î¿ Î±Ï€Î»ÏŒ.
            loginStaff: () => {
                const store = document.getElementById('inpStoreEmail').value;
                const name = document.getElementById('inpMyName').value;
                const role = document.getElementById('inpMyRole').value;
                if (!store || !name) return alert("Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î± Ï€ÎµÎ´Î¯Î±!");
                
                // Î¤Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ Ï€Î¬ÎµÎ¹ Ï€Î¬Î½Ï„Î± ÏƒÏ„Î¿ index.html Ï€ÏÎ¿Ï‚ Ï„Î¿ Ï€Î±ÏÏŒÎ½
                // Î•ÎºÏ„ÏŒÏ‚ Î±Î½ Î¸Î­Î»Î¿Ï…Î¼Îµ Î½Î± Ï„ÏƒÎµÎºÎ¬ÏÎ¿Ï…Î¼Îµ Ï„Î¿ store plan ÎºÎ±Î¹ Î³Î¹Î± Î±Ï…Ï„Î¿ÏÏ‚.
                App.saveAndRedirect({ store, name, role }, "index.html");
            },

            // Login Admin Manual
            loginAdminManual: () => {
                const email = document.getElementById('inpAdminManualEmail').value.trim();
                if (!email || !email.includes('@')) return alert("ÎˆÎ³ÎºÏ…ÏÎ¿ Email Ï€Î±ÏÎ±ÎºÎ±Î»Ï");
                App.checkSubscriptionAndProceed(email, "Admin", "admin");
            },

            // Login Google
            loginAdminGoogle: () => {
                signInWithPopup(auth, provider).then((result) => {
                    const email = result.user.email;
                    document.getElementById('inpAdminManualEmail').value = email;
                    App.checkSubscriptionAndProceed(email, "Admin", "admin");
                }).catch((error) => alert("Error: " + error.message));
            }
        };

        if (localStorage.getItem('bellgo_session')) {
            // Î‘Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· session, Î­Î»ÎµÎ³Î¾Îµ Ï€Î¿Ï Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€Î¬ÎµÎ¹
            const saved = JSON.parse(localStorage.getItem('bellgo_session'));
            if (saved.plan === 'premium') {
                window.location.href = "premium.html";
            } else {
                window.location.href = "index.html";
            }
        }
    </script>
</body>
</html>
