<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Bellgo Admin</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: #222; padding: 20px; border-radius: 15px; border: 1px solid #444; }
        
        /* Î›Î™Î£Î¤Î‘ ÎŸÎ”Î—Î“Î©Î */
        #drivers-list { margin-bottom: 20px; min-height: 100px; }
        
        /* ÎšÎŸÎ¥ÎœÎ Î™ ÎŸÎ”Î—Î“ÎŸÎ¥ */
        .driver-card { 
            display: flex; justify-content: space-between; align-items: center;
            background: #333; padding: 15px; margin: 10px 0; border-radius: 10px; border: 1px solid #555;
        }
        .driver-name { font-size: 1.2em; font-weight: bold; color: #fff; }
        .btn-call { 
            background: #ffc107; color: black; border: none; padding: 10px 20px; 
            font-weight: bold; border-radius: 5px; cursor: pointer; font-size: 1em;
        }
        .btn-call:active { background: #e0a800; transform: scale(0.95); }

        /* CHAT */
        #log-box { height: 300px; overflow-y: auto; background: #000; border: 1px solid #333; padding: 15px; text-align: left; font-family: monospace; font-size: 14px; margin-bottom: 10px; }
        .entry { border-bottom: 1px solid #222; padding: 5px 0; }
        .mine { color: #ffc107; text-align: right; display:block;} 
        .theirs { color: #00ccff; text-align: left; display:block;}
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color:#ffc107;">Î”Î™Î‘Î§Î•Î™Î¡Î™Î£Î— Î”Î™Î‘ÎÎŸÎœÎ—Î£</h1>
        <h3 id="shop-title" style="color:#888;">WAITING...</h3>

        <div id="drivers-list">
            <p style="color:#666">Î‘Î½Î±Î¼Î¿Î½Î® Î³Î¹Î± Î´Î¹Î±Î½Î¿Î¼ÎµÎ¯Ï‚...</p>
        </div>

        <h3>Chat</h3>
        <div id="log-box"></div>
        <div style="display:flex;">
            <input type="text" id="admin-msg" placeholder="ÎœÎ®Î½Ï…Î¼Î±..." style="flex:1; padding:10px;">
            <button onclick="sendMsg()" style="padding:10px; background:#444; color:white; border:none;">Send</button>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const SERVER_URL = 'https://bellgo-final.onrender.com';
        const socket = io(SERVER_URL);
        
        // Î¡Î¥Î˜ÎœÎ™Î£Î• Î¤ÎŸ ÎŸÎÎŸÎœÎ‘ Î¤ÎŸÎ¥ ÎœÎ‘Î“Î‘Î–Î™ÎŸÎ¥ Î•Î”Î© (Î‰ Î²Î¬Î»Ï„Î¿ Î½Î± Ï„Î¿ Î¶Î·Ï„Î¬ÎµÎ¹ Î¼Îµ prompt)
        const MY_SHOP = "Roasters"; // <--- Î‘Î›Î›Î‘ÎÎ• Î¤ÎŸ Î‘ÎÎ‘Î›ÎŸÎ“Î‘ Î¤ÎŸ ÎœÎ‘Î“Î‘Î–Î™
        const MY_NAME = "Admin";

        document.getElementById('shop-title').innerText = "SHOP: " + MY_SHOP;

        socket.on('connect', () => {
            // Login Ï‰Ï‚ Admin ÏƒÏ„Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ Shop Room
            socket.emit('login', { name: MY_NAME, shop: MY_SHOP, role: 'admin' });
        });

        // Î›Î—Î¨Î— Î›Î™Î£Î¤Î‘Î£ ÎŸÎ”Î—Î“Î©Î
        socket.on('update-drivers', (drivers) => {
            const list = document.getElementById('drivers-list');
            list.innerHTML = ""; // ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚
            
            if(drivers.length === 0) {
                list.innerHTML = "<p style='color:#666'>ÎšÎ±Î½Î­Î½Î±Ï‚ Î´Î¹Î±Î½Î¿Î¼Î­Î±Ï‚ online</p>";
                return;
            }

            drivers.forEach(d => {
                // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï Î³Î¹Î± ÎºÎ¬Î¸Îµ Î¿Î´Î·Î³ÏŒ
                list.innerHTML += `
                    <div class="driver-card">
                        <span class="driver-name">ğŸ›µ ${d.name}</span>
                        <button class="btn-call" onclick="callDriver('${d.id}')">ÎšÎ›Î—Î£Î— ğŸ””</button>
                    </div>`;
            });
        });

        // ÎšÎ›Î—Î£Î— Î£Î¥Î“ÎšÎ•ÎšÎ¡Î™ÎœÎ•ÎÎŸÎ¥ ÎŸÎ”Î—Î“ÎŸÎ¥
        function callDriver(socketId) {
            socket.emit('call-driver', socketId);
        }

        // CHAT (ÎœÎŸÎÎŸ ÎšÎ•Î™ÎœÎ•ÎÎŸ)
        function sendMsg() {
            const txt = document.getElementById('admin-msg').value;
            if(txt) {
                socket.emit('chat-message', { shop: MY_SHOP, user: MY_NAME, text: txt });
                document.getElementById('admin-msg').value = '';
            }
        }

        socket.on('chat-message', (data) => {
            const box = document.getElementById('log-box');
            const isMe = data.user === MY_NAME;
            box.innerHTML += `<div class="entry ${isMe ? 'mine' : 'theirs'}"><b>${data.user}:</b> ${data.text}</div>`;
            box.scrollTop = box.scrollHeight;
        });
    </script>
</body>
</html>
