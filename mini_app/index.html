<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BellGo Mini</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background-color: #000; color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            height: 100vh; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow: hidden;
        }

        .btn-call {
            width: 220px; height: 220px;
            border-radius: 50%;
            background: #D32F2F;
            border: 8px solid #FF5252;
            color: white;
            font-size: 32px; font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 40px rgba(211, 47, 47, 0.6);
            transition: transform 0.1s, background 0.2s;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column;
        }

        .btn-call:active { transform: scale(0.95); background: #B71C1C; }
        
        .status-text {
            margin-top: 30px;
            font-size: 18px;
            color: #aaa;
            font-weight: 500;
            text-align: center;
            padding: 0 20px;
        }

        .status-text.connected { color: #00E676; }
        .status-text.disconnected { color: #FF5252; }
        
        .accepted-anim {
            animation: flashSuccess 1s infinite alternate;
            color: #00E676;
            font-size: 22px;
        }

        @keyframes flashSuccess {
            0% { opacity: 1; text-shadow: 0 0 10px #00E676; }
            100% { opacity: 0.5; text-shadow: 0 0 20px #00E676; }
        }
    </style>
</head>
<body>
    <button id="btnCall" class="btn-call" onclick="triggerCall()">
        <span style="font-size:40px;">ðŸ””</span>
        <span>CALL</span>
    </button>
    
    <div id="statusMsg" class="status-text">Connecting...</div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const storeName = params.get('store');
        const myName = params.get('name') || 'MiniUser';
        let socket = null;

        if (storeName) {
            socket = io();
            
            socket.on('connect', () => {
                document.getElementById('statusMsg').innerText = "ðŸŸ¢ Connected";
                document.getElementById('statusMsg').className = "status-text connected";
                
                // Î£ÏÎ½Î´ÎµÏƒÎ· ÏƒÏ„Î¿ ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± Î³Î¹Î± Î½Î± Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ events
                socket.emit('join-store', { 
                    storeName: storeName, 
                    username: myName, 
                    role: 'waiter', 
                    isNative: false 
                });
            });
            
            socket.on('disconnect', () => {
                document.getElementById('statusMsg').innerText = "ðŸ”´ Disconnected";
                document.getElementById('statusMsg').className = "status-text disconnected";
            });

            // ðŸ‘‚ Î‘ÎšÎ¡ÎŸÎ‘Î£Î— Î‘Î ÎŸÎ”ÎŸÎ§Î—Î£ ÎšÎ›Î—Î£Î—Î£
            socket.on('staff-accepted-alarm', (data) => {
                const el = document.getElementById('statusMsg');
                el.innerText = `âœ… Î— ÎºÎ»Î®ÏƒÎ· Î­Î³Î¹Î½Îµ Î±Ï€Î¿Î´ÎµÎºÏ„Î® Î±Ï€ÏŒ: ${data.username}`;
                el.className = "status-text accepted-anim";
                
                if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
                
                // ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ 5 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
                setTimeout(() => { 
                    el.innerText = "ðŸŸ¢ Ready"; 
                    el.className = "status-text connected"; 
                }, 5000);
            });
        } else {
            document.getElementById('statusMsg').innerText = "âš ï¸ No Store ID provided";
        }

        function triggerCall() {
            if(!socket || !socket.connected) return alert("No connection!");
            
            // Trigger Alarm to Admin/Kitchen
            socket.emit('trigger-alarm', { target: 'Admin', source: myName });
            
            const btn = document.getElementById('btnCall');
            btn.style.background = "white";
            btn.style.color = "#D32F2F";
            setTimeout(() => {
                btn.style.background = "#D32F2F";
                btn.style.color = "white";
            }, 200);
            
            document.getElementById('statusMsg').innerText = "ðŸ”” Calling...";
        }
    </script>
</body>
</html>